"use strict";(()=>{var e={};e.id=6841,e.ids=[6841],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},2629:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>c,routeModule:()=>E});var o=a(1802),n=a(7153),r=a(6249),l=a(9599),i=e([l]);l=(i.then?(await i)():i)[0];let c=(0,r.l)(l,"default"),u=(0,r.l)(l,"config"),E=new o.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/newsletter-send",pathname:"/api/newsletter-send",bundlePath:"",filename:""},userland:l});s()}catch(e){s(e)}})},5980:(e,t,a)=>{a.d(t,{Hf:()=>r,iW:()=>n});let s=require("firebase-admin");var o=a.n(s);!function(){if(o().apps.length>0)return o().app();let e={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,privateKey:process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n"),clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL},t=process.env.FIREBASE_STORAGE_EMULATOR_HOST?"logbase-blog-83db6.appspot.com":"logbase-blog-83db6.firebasestorage.app";e.privateKey?o().initializeApp({credential:o().credential.cert(e),storageBucket:t}):(console.warn("Firebase Admin private key is not set. Using default credentials."),o().initializeApp({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID||"logbase-blog-83db6",storageBucket:t}))}();let n=o().firestore(),r=o().storage().bucket(),l=process.env.FIRESTORE_EMULATOR_HOST,i=process.env.FIREBASE_STORAGE_EMULATOR_HOST;l&&(console.log(`âœ… [Admin SDK] Firestore Emulator ì—°ê²°: ${l}`),console.log("   í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ ìë™ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤.")),i&&(console.log(`âœ… [Admin SDK] Storage Emulator ì„¤ì •: ${i}`),console.log("   í™˜ê²½ ë³€ìˆ˜ë¥¼ í†µí•´ ìë™ ì—°ê²°ë˜ì—ˆìŠµë‹ˆë‹¤."))},110:(e,t,a)=>{a.d(t,{S:()=>n,L:()=>r});let s=require("crypto");var o=a.n(s);function n(e){let t=process.env.UNSUBSCRIBE_SECRET||"default-secret-key";return o().createHmac("sha256",t).update(e).digest("hex").substring(0,16)}function r(e){let t=n(e),a="https://logbase.kr";if(process.env.FIREBASE_CONFIG||process.env.FUNCTION_TARGET){let e=process.env.FIREBASE_FUNCTION_URL||process.env.VERCEL_URL;a=e&&e.includes("logbase.kr")?"https://logbase.kr":e&&e.includes("localhost")?"http://localhost:3000":"https://logbase.kr"}else a="http://localhost:3000";return`${a}/unsubscribe?email=${encodeURIComponent(e)}&token=${t}`}},9599:(e,t,a)=>{a.a(e,async(e,s)=>{try{a.r(t),a.d(t,{default:()=>E});var o=a(9648),n=a(5980),r=a(110),l=e([o]);o=(l.then?(await l)():l)[0];let p="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI0IiwianRpIjoiN2IwNDAwNDFmNmRhZjA0MWJiOWY2MWZhMTk5YmI1YjUyNTZkMjljYTRiZTI1OTkyMzFjOTIxMzU2MjdlNDZiNWZjY2EzYzc1MzY1MTc5ODUiLCJpYXQiOjE3NTM3NTgzMDQuMTM2ODk4LCJuYmYiOjE3NTM3NTgzMDQuMTM2OSwiZXhwIjo0OTA5NDMxOTA0LjEzMjkxOCwic3ViIjoiMTcxMTk4NCIsInNjb3BlcyI6W119.LCqYE-D57xn-4m65pSpiKfSlCoYqzSbRK5gPJoTP9hVWaifxwuQvNWPQdo16IUoZAbb_xb9E6rjHP9eGaGO0ta2r5PJnXafKPjY4n75Zn6BpZElha5X_fs-mcH83kEyyKrZbGZCXTyY8wxnZsbYtxj5ryWCTF6IBrHqE-2wPas--CthBdCCiUDTz4OQ6ga4NeS04DpZ2OYSi2Pg_ttjX6JEaoaf3dEGgOwYlGbMpy3TBcxK5Bji2_Ato-VmLmI9oPAH0q16KcFdrDi5dgzVP86PfQFt-7H2hgUl7abMWgwCMM41ldLPj15VaFGDVbDczm31A09ttQ1umusLQY1N91dEgkNaZZP1_Rp7KQLVJxOois89UyQxK4FNTEnVIHCfq8oVkhz3bp9QdadYYn1wJNdwwZfNAUHAYb1A_hMiHEiWJ1-VJd1e3DgqOZ3rmmr40d15eaz3EJpHVWhT3mn3VAg7SkHl4r1kbEIE950DpiBZ0CVtAWP7-DW0pMgVY6kdtyrS8kTasX7MH01fL0ZVrQm58JEh6R47y715qOMeL3oNk1n8Szt_cTYfOKz75uXf5COPqp1sMxloa6bw42xs3wemqXV5w-mn7Uupj1a7wdoYs39kaIaKZLZvcqExSMo12zYMSkYEDn8-XZFvplQsLCPYfmQQ1MX6OwkLLDas38oY",m="https://connect.mailerlite.com/api",d=()=>({Authorization:`Bearer ${p}`,"Content-Type":"application/json",Accept:"application/json"});async function i(e){try{let t=await o.default.post(`${m}/subscribers`,{email:e.email,fields:{name:e.name,company:e.company,phone:e.phone,unsubscribe_url:(0,r.L)(e.email)},status:"active"},{headers:d()});return console.log(`âœ… [MAILERLITE] êµ¬ë…ì ë™ê¸°í™” ì„±ê³µ: ${e.email} (${e.name})`),t.data.data}catch(t){if(t.response?.status===409)try{console.log(`ğŸ”„ [MAILERLITE] ê¸°ì¡´ êµ¬ë…ì ì—…ë°ì´íŠ¸ ì‹œë„: ${e.email}`);let t=await o.default.put(`${m}/subscribers/${e.email}`,{fields:{name:e.name,company:e.company,phone:e.phone,unsubscribe_url:(0,r.L)(e.email)}},{headers:d()});return console.log(`âœ… [MAILERLITE] êµ¬ë…ì ì—…ë°ì´íŠ¸ ì„±ê³µ: ${e.email} (${e.name})`),t.data.data}catch(t){throw console.error(`âŒ [MAILERLITE] êµ¬ë…ì ì—…ë°ì´íŠ¸ ì‹¤íŒ¨ ${e.email}:`,t.response?.data||t.message),t}else throw console.error(`âŒ [MAILERLITE] êµ¬ë…ì ë™ê¸°í™” ì‹¤íŒ¨ ${e.email}:`,t.response?.data||t.message),t}}async function c(e){let t="LOGBASE_NEWSLETTER_TEMPLATE";try{console.log("\uD83D\uDD0D [MAILERLITE] ê¸°ì¡´ í…œí”Œë¦¿ ì°¾ëŠ” ì¤‘...");let a=(await o.default.get(`${m}/templates`,{headers:d()})).data.data.find(e=>e.name===t);if(a)return console.log(`ğŸ”„ [MAILERLITE] ê¸°ì¡´ í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ ì¤‘... (ID: ${a.id})`),await o.default.put(`${m}/templates/${a.id}`,{name:t,html:e},{headers:d()}),console.log("âœ… [MAILERLITE] í…œí”Œë¦¿ ì—…ë°ì´íŠ¸ ì™„ë£Œ"),a.id;{console.log("\uD83C\uDD95 [MAILERLITE] ìƒˆ í…œí”Œë¦¿ ìƒì„± ì¤‘...");let a=await o.default.post(`${m}/templates`,{name:t,html:e},{headers:d()});return console.log("âœ… [MAILERLITE] ìƒˆ í…œí”Œë¦¿ ìƒì„± ì™„ë£Œ"),a.data.data.id}}catch(e){throw console.error("âŒ [MAILERLITE] í…œí”Œë¦¿ ê´€ë¦¬ ì‹¤íŒ¨:",e.response?.data||e.message),e}}async function u(e,t,a,s,n){try{let r=await c(s),l={name:`Newsletter: ${e} - ${new Date().toISOString().slice(0,10)}`,type:"regular",emails:[{subject:e,from_name:t,from:a,template_id:r,personalization:{name:"{{name}}",company:"{{company}}",email:"{{email}}",unsubscribe_url:"{{unsubscribe_url}}"}}]};console.log("\uD83D\uDCE7 [MAILERLITE] ê°œì¸í™” ìº í˜ì¸ ìƒì„± ì¤‘...");let i=(await o.default.post(`${m}/campaigns`,l,{headers:d()})).data.data.id;return console.log(`âœ… [MAILERLITE] ê°œì¸í™” ìº í˜ì¸ ìƒì„± ì™„ë£Œ. ID: ${i}`),console.log("\uD83D\uDE80 [MAILERLITE] ê°œì¸í™” ìº í˜ì¸ ë°œì†¡ ì¤‘..."),await o.default.post(`${m}/campaigns/${i}/schedule`,{delivery:"instant"},{headers:d()}),console.log("âœ… [MAILERLITE] ê°œì¸í™” ìº í˜ì¸ ë°œì†¡ ì™„ë£Œ!"),console.log(`ğŸ‘¥ [MAILERLITE] ${n.length}ëª…ì—ê²Œ ê°œì¸í™”ëœ ë‰´ìŠ¤ë ˆí„° ë°œì†¡ë¨`),{campaignId:i,campaignName:l.name,recipientCount:n.length,personalized:!0}}catch(e){throw console.error("âŒ [MAILERLITE] ìº í˜ì¸ ìƒì„±/ë°œì†¡ ì‹¤íŒ¨:",e.response?.data||e.message),e}}async function E(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let a;let{filename:s,subject:o,fromName:r,fromEmail:l,recipients:c}=e.body;if(console.log("\uD83C\uDFAF [NEWSLETTER SEND] ìš”ì²­ ë°›ìŒ:",{filename:s,subject:o,fromName:r,fromEmail:l,recipientCount:c?.length}),!s||!o||!r||!l||!c||0===c.length)return t.status(400).json({success:!1,message:"í•„ìˆ˜ ì •ë³´ê°€ ëˆ„ë½ë˜ì—ˆìŠµë‹ˆë‹¤. (filename, subject, fromName, fromEmail, recipients)"});let E="true"===process.env.NEWSLETTER_TEST_MODE;if(!p&&!E)return t.status(500).json({success:!1,message:"MailerLite API í‚¤ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. í™˜ê²½ ë³€ìˆ˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”."});let m=`newsletters/${s}.html`,d=n.Hf.file(m);try{let[e]=await d.exists();if(!e)return t.status(404).json({success:!1,message:`ë‰´ìŠ¤ë ˆí„° HTML íŒŒì¼ì„ ì°¾ì„ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${s}.html`});let[o]=await d.download();a=o.toString("utf-8"),console.log("\uD83D\uDCC4 [NEWSLETTER SEND] Cloud Storageì—ì„œ HTML íŒŒì¼ ë¡œë“œ ì™„ë£Œ")}catch(e){return console.error("[NEWSLETTER SEND] Cloud Storage íŒŒì¼ ì½ê¸° ì‹¤íŒ¨:",e),t.status(500).json({success:!1,message:`ë‰´ìŠ¤ë ˆí„° HTML íŒŒì¼ì„ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ${s}.html`})}if(E)return console.log("\uD83E\uDDEA [TEST MODE] ë‰´ìŠ¤ë ˆí„° ë°œì†¡ ì‹œë®¬ë ˆì´ì…˜"),console.log("\uD83D\uDCE7 ì œëª©:",o),console.log("\uD83D\uDC64 ë°œì‹ ì:",`${r} <${l}>`),console.log("\uD83D\uDC65 ìˆ˜ì‹ ì ìˆ˜:",c.length),console.log("\uD83D\uDCDD HTML ê¸¸ì´:",a.length),t.status(200).json({success:!0,message:`í…ŒìŠ¤íŠ¸ ëª¨ë“œ: ${c.length}ëª…ì—ê²Œ ê°œì¸í™”ëœ "${o}" ë‰´ìŠ¤ë ˆí„° ë°œì†¡ ì‹œë®¬ë ˆì´ì…˜ ì™„ë£Œ`,campaignId:"test-campaign-"+Date.now(),testMode:!0,personalized:!0});console.log("\uD83D\uDC65 [NEWSLETTER SEND] êµ¬ë…ì ë™ê¸°í™” ì‹œì‘...");let g=c.map(e=>i(e));try{await Promise.all(g),console.log(`âœ… [NEWSLETTER SEND] ${c.length}ëª… êµ¬ë…ì ë™ê¸°í™” ì™„ë£Œ`)}catch(e){console.warn("âš ï¸ [NEWSLETTER SEND] ì¼ë¶€ êµ¬ë…ì ë™ê¸°í™” ì‹¤íŒ¨, ê³„ì† ì§„í–‰...")}let T=await u(o,r,l,a,c),I={filename:s,subject:o,fromName:r,fromEmail:l,recipientCount:c.length,campaignId:T.campaignId,campaignName:T.campaignName,sentAt:new Date().toISOString(),status:"sent",personalized:!0,personalizationFields:["name","company","email","unsubscribe_url"]};return console.log("\uD83C\uDF89 [NEWSLETTER SEND] ë°œì†¡ ì™„ë£Œ!",I),t.status(200).json({success:!0,message:`${c.length}ëª…ì—ê²Œ ê°œì¸í™”ëœ ë‰´ìŠ¤ë ˆí„°ê°€ ì„±ê³µì ìœ¼ë¡œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤!`,data:I})}catch(a){console.error("\uD83D\uDCA5 [NEWSLETTER SEND] ë°œì†¡ ì‹¤íŒ¨:",a);let e=a instanceof Error?a.message:"ì•Œ ìˆ˜ ì—†ëŠ” ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";return t.status(500).json({success:!1,message:`ë‰´ìŠ¤ë ˆí„° ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤: ${e}`,error:void 0})}}s()}catch(e){s(e)}})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=2629);module.exports=a})();