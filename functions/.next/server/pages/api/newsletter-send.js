"use strict";(()=>{var e={};e.id=841,e.ids=[841],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,a){return a in t?t[a]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,a)):"function"==typeof t&&"default"===a?t:void 0}}})},2629:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{config:()=>u,default:()=>c,routeModule:()=>E});var s=a(1802),o=a(7153),r=a(6249),i=a(9599),l=e([i]);i=(l.then?(await l)():l)[0];let c=(0,r.l)(i,"default"),u=(0,r.l)(i,"config"),E=new s.PagesAPIRouteModule({definition:{kind:o.x.PAGES_API,page:"/api/newsletter-send",pathname:"/api/newsletter-send",bundlePath:"",filename:""},userland:i});n()}catch(e){n(e)}})},9599:(e,t,a)=>{a.a(e,async(e,n)=>{try{a.r(t),a.d(t,{default:()=>E});var s=a(9648),o=a(3292),r=a(1017),i=a.n(r),l=e([s]);s=(l.then?(await l)():l)[0];let m="eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzI1NiJ9.eyJhdWQiOiI0IiwianRpIjoiN2IwNDAwNDFmNmRhZjA0MWJiOWY2MWZhMTk5YmI1YjUyNTZkMjljYTRiZTI1OTkyMzFjOTIxMzU2MjdlNDZiNWZjY2EzYzc1MzY1MTc5ODUiLCJpYXQiOjE3NTM3NTgzMDQuMTM2ODk4LCJuYmYiOjE3NTM3NTgzMDQuMTM2OSwiZXhwIjo0OTA5NDMxOTA0LjEzMjkxOCwic3ViIjoiMTcxMTk4NCIsInNjb3BlcyI6W119.LCqYE-D57xn-4m65pSpiKfSlCoYqzSbRK5gPJoTP9hVWaifxwuQvNWPQdo16IUoZAbb_xb9E6rjHP9eGaGO0ta2r5PJnXafKPjY4n75Zn6BpZElha5X_fs-mcH83kEyyKrZbGZCXTyY8wxnZsbYtxj5ryWCTF6IBrHqE-2wPas--CthBdCCiUDTz4OQ6ga4NeS04DpZ2OYSi2Pg_ttjX6JEaoaf3dEGgOwYlGbMpy3TBcxK5Bji2_Ato-VmLmI9oPAH0q16KcFdrDi5dgzVP86PfQFt-7H2hgUl7abMWgwCMM41ldLPj15VaFGDVbDczm31A09ttQ1umusLQY1N91dEgkNaZZP1_Rp7KQLVJxOois89UyQxK4FNTEnVIHCfq8oVkhz3bp9QdadYYn1wJNdwwZfNAUHAYb1A_hMiHEiWJ1-VJd1e3DgqOZ3rmmr40d15eaz3EJpHVWhT3mn3VAg7SkHl4r1kbEIE950DpiBZ0CVtAWP7-DW0pMgVY6kdtyrS8kTasX7MH01fL0ZVrQm58JEh6R47y715qOMeL3oNk1n8Szt_cTYfOKz75uXf5COPqp1sMxloa6bw42xs3wemqXV5w-mn7Uupj1a7wdoYs39kaIaKZLZvcqExSMo12zYMSkYEDn8-XZFvplQsLCPYfmQQ1MX6OwkLLDas38oY",p="https://connect.mailerlite.com/api",d=()=>({Authorization:`Bearer ${m}`,"Content-Type":"application/json",Accept:"application/json"});async function c(e){try{let t=await s.default.post(`${p}/subscribers`,{email:e.email,fields:{name:e.name,company:e.company,phone:e.phone},status:"active"},{headers:d()});return console.log(`✅ [MAILERLITE] 구독자 동기화 성공: ${e.email}`),t.data.data}catch(t){throw console.error(`❌ [MAILERLITE] 구독자 동기화 실패 ${e.email}:`,t.response?.data||t.message),t}}async function u(e,t,a,n,o){try{let r={name:`Newsletter: ${e} - ${new Date().toISOString().slice(0,10)}`,type:"regular",emails:[{subject:e,from_name:t,from:a,content:n}]};console.log("\uD83D\uDCE7 [MAILERLITE] 캠페인 생성 중...");let i=(await s.default.post(`${p}/campaigns`,r,{headers:d()})).data.data.id;return console.log(`✅ [MAILERLITE] 캠페인 생성 완료. ID: ${i}`),console.log("\uD83D\uDE80 [MAILERLITE] 캠페인 발송 중..."),await s.default.post(`${p}/campaigns/${i}/schedule`,{delivery:"instant"},{headers:d()}),console.log("✅ [MAILERLITE] 캠페인 발송 완료!"),{campaignId:i,campaignName:r.name,recipientCount:o.length}}catch(e){throw console.error("❌ [MAILERLITE] 캠페인 생성/발송 실패:",e.response?.data||e.message),e}}async function E(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let a;let{filename:n,subject:s,fromName:r,fromEmail:l,recipients:E}=e.body;if(console.log("\uD83C\uDFAF [NEWSLETTER SEND] 요청 받음:",{filename:n,subject:s,fromName:r,fromEmail:l,recipientCount:E?.length}),!n||!s||!r||!l||!E||0===E.length)return t.status(400).json({success:!1,message:"필수 정보가 누락되었습니다. (filename, subject, fromName, fromEmail, recipients)"});let p="true"===process.env.NEWSLETTER_TEST_MODE;if(!m&&!p)return t.status(500).json({success:!1,message:"MailerLite API 키가 설정되지 않았습니다. 환경 변수를 확인해주세요."});let d=i().resolve(process.cwd(),`public/newsletters/${n}.html`);try{a=await (0,o.readFile)(d,"utf-8"),console.log("\uD83D\uDCC4 [NEWSLETTER SEND] HTML 파일 로드 완료")}catch(e){return t.status(404).json({success:!1,message:`뉴스레터 HTML 파일을 찾을 수 없습니다: ${n}.html`})}if(p)return console.log("\uD83E\uDDEA [TEST MODE] 뉴스레터 발송 시뮬레이션"),console.log("\uD83D\uDCE7 제목:",s),console.log("\uD83D\uDC64 발신자:",`${r} <${l}>`),console.log("\uD83D\uDC65 수신자 수:",E.length),console.log("\uD83D\uDCDD HTML 길이:",a.length),t.status(200).json({success:!0,message:`테스트 모드: ${E.length}명에게 "${s}" 뉴스레터 발송 시뮬레이션 완료`,campaignId:"test-campaign-"+Date.now(),testMode:!0});console.log("\uD83D\uDC65 [NEWSLETTER SEND] 구독자 동기화 시작...");let D=E.map(e=>c(e));try{await Promise.all(D),console.log(`✅ [NEWSLETTER SEND] ${E.length}명 구독자 동기화 완료`)}catch(e){console.warn("⚠️ [NEWSLETTER SEND] 일부 구독자 동기화 실패, 계속 진행...")}let g=await u(s,r,l,a,E),T={filename:n,subject:s,fromName:r,fromEmail:l,recipientCount:E.length,campaignId:g.campaignId,campaignName:g.campaignName,sentAt:new Date().toISOString(),status:"sent"};return console.log("\uD83C\uDF89 [NEWSLETTER SEND] 발송 완료!",T),t.status(200).json({success:!0,message:"뉴스레터가 성공적으로 발송되었습니다!",data:T})}catch(a){console.error("\uD83D\uDCA5 [NEWSLETTER SEND] 발송 실패:",a);let e=a instanceof Error?a.message:"알 수 없는 오류가 발생했습니다.";return t.status(500).json({success:!1,message:`뉴스레터 발송에 실패했습니다: ${e}`,error:void 0})}}n()}catch(e){n(e)}})},7153:(e,t)=>{var a;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return a}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(a||(a={}))},1802:(e,t,a)=>{e.exports=a(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var a=t(t.s=2629);module.exports=a})();