"use strict";(()=>{var e={};e.id=7801,e.ids=[7801],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2048:e=>{e.exports=require("fs")},5315:e=>{e.exports=require("path")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7270:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{config:()=>g,default:()=>c,routeModule:()=>u});var s=r(1802),a=r(7153),l=r(6249),i=r(5213),n=e([i]);i=(n.then?(await n)():n)[0];let c=(0,l.l)(i,"default"),g=(0,l.l)(i,"config"),u=new s.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/rss-migrate",pathname:"/api/rss-migrate",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},4810:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{I:()=>u,db:()=>g,l:()=>c});var s=r(3745),a=r(1492),l=r(401),i=e([s,a,l]);[s,a,l]=i.then?(await i)():i;let n={apiKey:"AIzaSyA6kCmSqaBH5SUPb4PkHU1hwe0l5Ppqw2w",authDomain:"logbase-blog-83db6.firebaseapp.com",projectId:"logbase-blog-83db6",storageBucket:"logbase-blog-83db6.firebasestorage.app",messagingSenderId:"938632982963",appId:"1:938632982963:web:6159f776e4466bf74bdbc6"};if(!n.apiKey||!n.projectId)throw Error("Firebase ì„¤ì •ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤. .env.local íŒŒì¼ì— NEXT_PUBLIC_FIREBASE_ í™˜ê²½ ë³€ìˆ˜ë¥¼ í™•ì¸í•´ì£¼ì„¸ìš”.");let c=0===(0,s.getApps)().length?(0,s.initializeApp)(n):(0,s.getApps)()[0],g=(0,a.getFirestore)(c),u=(0,l.getAuth)(c);o()}catch(e){o(e)}})},531:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.d(t,{Y:()=>u});var s=r(1492),a=r(4810),l=r(2048),i=r.n(l),n=r(5315),c=r.n(n),g=e([s,a]);[s,a]=g.then?(await g)():g;class u{constructor(e="../logbase-blog-astro/public/rss"){this.rssDirectory=e}async parseRSSFiles(){try{let e=await this.getRSSFiles(),t=[];for(let r of e)try{let e=c().join(this.rssDirectory,r),o=i().readFileSync(e,"utf-8"),s=JSON.parse(o),a=c().basename(r,".json").match(/(\d{8})/);a&&(s.collectedDate=a[1]),t.push(s)}catch(e){console.error(`Error parsing file ${r}:`,e)}return t}catch(e){throw console.error("Error parsing RSS files:",e),e}}async getRSSFiles(){try{return i().readdirSync(this.rssDirectory).filter(e=>e.endsWith(".json"))}catch(e){return console.error("Error reading RSS directory:",e),[]}}async saveToFirestore(e){try{console.log("\uD83D\uDD25 Firestore ì—°ê²° í…ŒìŠ¤íŠ¸ ì¤‘...");let t=(0,s.collection)(a.db,"rss_items"),r=(0,s.query)(t,(0,s.limit)(1));try{await (0,s.getDocs)(r),console.log("âœ… Firestore ì—°ê²° ì„±ê³µ")}catch(e){throw console.error("âŒ Firestore ì—°ê²° ì‹¤íŒ¨:",e),Error(`Firestore ì—°ê²° ì‹¤íŒ¨: ${e}`)}let o=0,l=0,i=0;console.log(`ğŸ“ ${e.length}ê°œ ì•„ì´í…œ ì €ì¥ ì‹œì‘...`);for(let r=0;r<e.length;r++){let n=e[r];console.log(`ğŸ”„ ì²˜ë¦¬ ì¤‘ (${r+1}/${e.length}): ${n.blogName} - ${n.title?.substring(0,30)}...`);try{let e={title:n.title?.substring(0,1e3)||"",link:n.link?.substring(0,500)||"",pubDate:n.pubDate?.substring(0,100)||"",description:n.description?.substring(0,2e3)||"",guid:n.guid?.substring(0,500)||"",isoDate:n.isoDate?.substring(0,100)||"",blogName:n.blogName?.substring(0,100)||"",feedType:n.feedType||"noncompetitor",matchedKeywords:Array.isArray(n.matchedKeywords)?n.matchedKeywords.slice(0,10).map(e=>e.substring(0,100)):[],collectedDate:n.collectedDate?.substring(0,20)||"",createdAt:new Date,updatedAt:new Date};console.log(`ğŸ“‹ ë°ì´í„° ì¤€ë¹„ ì™„ë£Œ: ${n.blogName}`);let r=(0,s.query)(t,(0,s.where)("guid","==",n.guid));console.log(`ğŸ” ì¤‘ë³µ ì²´í¬ ì¤‘: ${n.guid}`);let i=await (0,s.getDocs)(r);if(i.empty)console.log(`ğŸ’¾ ìƒˆ ë¬¸ì„œ ì €ì¥ ì¤‘: ${n.blogName}`),await (0,s.addDoc)(t,e),o++,console.log(`âœ… ì €ì¥ë¨: ${n.blogName} - ${n.title?.substring(0,50)}...`);else{console.log(`ğŸ”„ ê¸°ì¡´ ë¬¸ì„œ ì—…ë°ì´íŠ¸ ì¤‘: ${n.blogName}`);let t=(0,s.doc)(a.db,"rss_items",i.docs[0].id);await (0,s.updateDoc)(t,{...e,updatedAt:new Date}),l++,console.log(`â­ï¸ ê±´ë„ˆëœ€: ${n.blogName} - ${n.title?.substring(0,50)}...`)}}catch(t){console.error(`âŒ ì—ëŸ¬ ë°œìƒ: ${n.blogName} - ${n.guid}`,t),i++;let e=t instanceof Error?t.message:String(t);throw Error(`RSS ì €ì¥ ì¤‘ ì—ëŸ¬ ë°œìƒ: ${n.blogName} - ${n.guid} - ${e}`)}await new Promise(e=>setTimeout(e,200))}console.log(`ğŸ‰ RSS ì €ì¥ ì™„ë£Œ: ${o}ê°œ ìƒˆë¡œ ì €ì¥, ${l}ê°œ ì—…ë°ì´íŠ¸, ${i}ê°œ ì—ëŸ¬`)}catch(e){throw console.error("\uD83D\uDCA5 Error saving to Firestore:",e),e}}sanitizeForFirestore(e){let t={};for(let[r,o]of Object.entries(e))if(null!=o){if("string"==typeof o&&o.length>1e6)t[r]=o.substring(0,1e6)+"... [truncated]";else if("isoDate"===r&&"string"==typeof o)try{t[r]=new Date(o)}catch{t[r]=o}else Array.isArray(o)?t[r]=o.map(e=>"string"==typeof e&&e.length>1e3?e.substring(0,1e3):e):t[r]=o}return t}async getFromFirestore(e=50){try{let t=(0,s.collection)(a.db,"rss_items"),r=(0,s.query)(t,(0,s.orderBy)("isoDate","desc"),(0,s.limit)(e)),o=await (0,s.getDocs)(r),l=[];return o.forEach(e=>{l.push(e.data())}),l}catch(e){throw console.error("Error getting from Firestore:",e),e}}async getByBlogName(e,t=20){try{let r=(0,s.collection)(a.db,"rss_items"),o=(0,s.query)(r,(0,s.where)("blogName","==",e),(0,s.orderBy)("isoDate","desc"),(0,s.limit)(t)),l=await (0,s.getDocs)(o),i=[];return l.forEach(e=>{i.push(e.data())}),i}catch(e){throw console.error("Error getting by blog name:",e),e}}async migrateAllRSSData(){try{console.log("RSS ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹œì‘...");let e=await this.parseRSSFiles();console.log(`ì´ ${e.length}ê°œì˜ RSS ì•„ì´í…œì„ íŒŒì‹±í–ˆìŠµë‹ˆë‹¤.`),await this.saveToFirestore(e),console.log("RSS ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì™„ë£Œ!")}catch(e){throw console.error("RSS ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤íŒ¨:",e),e}}}o()}catch(e){o(e)}})},5213:(e,t,r)=>{r.a(e,async(e,o)=>{try{r.r(t),r.d(t,{default:()=>n});var s=r(531),a=r(4810),l=r(1492),i=e([s,a,l]);async function n(e,t){if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),"OPTIONS"===e.method){t.status(200).end();return}if("POST"===e.method)try{let e=new s.Y;await e.migrateAllRSSData(),t.status(200).json({success:!0,message:"RSS ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤."})}catch(e){console.error("RSS ë§ˆì´ê·¸ë ˆì´ì…˜ ì—ëŸ¬:",e),t.status(500).json({success:!1,error:"RSS ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}else if("GET"===e.method)try{let{blogName:r,pageSize:o="10",feedType:s,searchText:i="",page:n="1"}=e.query,c=parseInt(o),g=parseInt(n),u=i.toLowerCase(),d=(0,l.collection)(a.db,"rss_items"),h=[],p=0,y=0,b=(0,l.query)(d,(0,l.orderBy)("isoDate","desc"));r&&"all"!==r&&(b=(0,l.query)(d,(0,l.where)("blogName","==",r),(0,l.orderBy)("isoDate","desc"))),s&&"all"!==s&&(b=r&&"all"!==r?(0,l.query)(d,(0,l.where)("blogName","==",r),(0,l.where)("feedType","==",s),(0,l.orderBy)("isoDate","desc")):(0,l.query)(d,(0,l.where)("feedType","==",s),(0,l.orderBy)("isoDate","desc"))),console.log("\uD83D\uDD0D ì¿¼ë¦¬ ì¡°ê±´:",{blogName:r,feedType:s,searchText:i,page:n,pageSize:o});let m=(await (0,l.getDocs)(b)).docs.map(e=>e.data());console.log("\uD83D\uDCCA ì „ì²´ ë°ì´í„° ìˆ˜:",m.length),u&&(m=m.filter(e=>e.blogName&&e.blogName.toLowerCase().includes(u)||e.title&&e.title.toLowerCase().includes(u)||e.description&&e.description.toLowerCase().includes(u)),console.log("\uD83D\uDD0D ê²€ìƒ‰ í•„í„° í›„ ë°ì´í„° ìˆ˜:",m.length)),y=m.length;let S=(g-1)*c,f=S+c;h=m.slice(S,f),console.log("\uD83D\uDCC4 í˜ì´ì§€ë„¤ì´ì…˜:",{page:g,pageSize:c,startIdx:S,endIdx:f,resultCount:h.length,filteredCount:y}),p=(await (0,l.getCountFromServer)(d)).data().count;let D=h.length>0?h[h.length-1].isoDate:null;t.status(200).json({success:!0,data:h,count:h.length,totalCount:p,filteredCount:y,lastIsoDate:D,currentPage:g,totalPages:Math.ceil(y/c)})}catch(e){console.error("RSS ì¡°íšŒ ì—ëŸ¬:",e),t.status(500).json({success:!1,error:"RSS ë°ì´í„° ì¡°íšŒ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤."})}else t.setHeader("Allow",["GET","POST"]),t.status(405).end(`Method ${e.method} Not Allowed`)}[s,a,l]=i.then?(await i)():i,o()}catch(e){o(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var r=t(t.s=7270);module.exports=r})();