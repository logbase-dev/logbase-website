"use strict";(()=>{var e={};e.id=3399,e.ids=[3399],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},3478:(e,t,s)=>{s.r(t),s.d(t,{config:()=>T,default:()=>p,routeModule:()=>g});var o={};s.r(o),s.d(o,{default:()=>d});var r=s(1802),n=s(7153),l=s(6249),a=s(629),E=s.n(a),i=s(5315),c=s.n(i),u=s(5980);async function d(e,t){if("POST"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{filename:s}=e.body;if(!s)return t.status(400).json({success:!1,message:"파일명이 필요합니다."});let o=c().resolve(process.cwd(),"public/newsletters/newsletters.json"),r=c().resolve(process.cwd(),`public/newsletters/${s}.html`),n=!1;try{await E().access(r),n=!0}catch{n=!1}let l=[],a=!1;if(process.env.FIREBASE_CONFIG||process.env.FUNCTION_TARGET){console.log("[NEWSLETTER-DELETE] Firebase Functions 환경에서 Cloud Storage 사용");try{let e=u.Hf.file("newsletters/newsletters.json"),[t]=await e.exists();if(t){let[t]=await e.download(),o=t.toString("utf-8");l=JSON.parse(o),Array.isArray(l)||(l=[]),a=l.some(e=>e.filename===s),console.log(`[NEWSLETTER-DELETE] Cloud Storage에서 ${l.length}개 뉴스레터 로드`)}else console.log("[NEWSLETTER-DELETE] Cloud Storage에 newsletters.json 파일이 없습니다."),l=[],a=!1}catch(e){console.error("[NEWSLETTER-DELETE] Cloud Storage 읽기 실패:",e),l=[],a=!1}}else{console.log("[NEWSLETTER-DELETE] 로컬 환경에서 로컬 파일 사용");try{let e=await E().readFile(o,"utf-8");l=JSON.parse(e),Array.isArray(l)||(l=[]),a=l.some(e=>e.filename===s),console.log(`[NEWSLETTER-DELETE] 로컬 파일에서 ${l.length}개 뉴스레터 로드`)}catch{l=[],a=!1}}let i=[],d=[];try{let e;if(n&&(await E().unlink(r),console.log(`[DELETE] HTML 파일 삭제됨: ${r}`),i.push("HTML 파일")),a){let e=l.filter(e=>e.filename!==s);if(process.env.FIREBASE_CONFIG||process.env.FUNCTION_TARGET){console.log("[NEWSLETTER-DELETE] Firebase Functions 환경에서 Cloud Storage 사용");try{let t=u.Hf.file("newsletters/newsletters.json");await t.save(JSON.stringify(e,null,2),{metadata:{contentType:"application/json"}}),console.log("[NEWSLETTER-DELETE] Cloud Storage newsletters.json 업데이트 완료")}catch(e){console.error("[NEWSLETTER-DELETE] Cloud Storage 업데이트 실패:",e),d.push("Cloud Storage JSON 업데이트 실패")}}else console.log("[NEWSLETTER-DELETE] 로컬 환경에서 로컬 파일 사용"),await E().writeFile(o,JSON.stringify(e,null,2),"utf-8"),console.log("[NEWSLETTER-DELETE] 로컬 newsletters.json 업데이트 완료");i.push("목록 항목")}let c=`newsletters/${s}.html`,p=u.Hf.file(c);try{let[e]=await p.exists();e&&(await p.delete(),console.log(`[DELETE] Cloud Storage 파일 삭제됨: ${c}`),i.push("Cloud Storage 파일"))}catch(e){console.error("[DELETE] Cloud Storage 파일 삭제 실패:",e),d.push("Cloud Storage 파일 삭제 실패")}return e=i.length>0?`'${s}' 뉴스레터 삭제 완료 (${i.join(", ")})`:`'${s}' 뉴스레터가 이미 존재하지 않습니다.`,d.length>0&&(e+=` - 경고: ${d.join(", ")}`),t.status(200).json({success:!0,message:e,details:{htmlDeleted:i.includes("HTML 파일"),jsonDeleted:i.includes("목록 항목"),storageDeleted:i.includes("Cloud Storage 파일"),errors:d}})}catch(e){return console.error("[DELETE] 삭제 중 오류:",e),t.status(500).json({success:!1,message:"뉴스레터 삭제 중 오류가 발생했습니다.",error:e instanceof Error?e.message:"알 수 없는 오류"})}}catch(e){return console.error("뉴스레터 삭제 중 오류:",e),t.status(500).json({success:!1,message:"뉴스레터 삭제에 실패했습니다.",error:e instanceof Error?e.message:"알 수 없는 오류"})}}let p=(0,l.l)(o,"default"),T=(0,l.l)(o,"config"),g=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/newsletter-delete",pathname:"/api/newsletter-delete",bundlePath:"",filename:""},userland:o})},5980:(e,t,s)=>{s.d(t,{Hf:()=>l,iW:()=>n});let o=require("firebase-admin");var r=s.n(o);!function(){if(r().apps.length>0)return r().app();let e={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,privateKey:process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n"),clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL},t=process.env.FIREBASE_STORAGE_EMULATOR_HOST?"logbase-blog-83db6.appspot.com":"logbase-blog-83db6.firebasestorage.app";e.privateKey?r().initializeApp({credential:r().credential.cert(e),storageBucket:t}):(console.warn("Firebase Admin private key is not set. Using default credentials."),r().initializeApp({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID||"logbase-blog-83db6",storageBucket:t}))}();let n=r().firestore(),l=r().storage().bucket(),a=process.env.FIRESTORE_EMULATOR_HOST,E=process.env.FIREBASE_STORAGE_EMULATOR_HOST;a&&(console.log(`✅ [Admin SDK] Firestore Emulator 연결: ${a}`),console.log("   환경 변수를 통해 자동 연결되었습니다.")),E&&(console.log(`✅ [Admin SDK] Storage Emulator 설정: ${E}`),console.log("   환경 변수를 통해 자동 연결되었습니다."))},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var s=t(t.s=3478);module.exports=s})();