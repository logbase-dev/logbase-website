"use strict";(()=>{var e={};e.id=786,e.ids=[786],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},9648:e=>{e.exports=import("axios")},295:e=>{e.exports=import("cheerio")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},3292:e=>{e.exports=require("fs/promises")},1017:e=>{e.exports=require("path")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7014:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{config:()=>p,default:()=>c,routeModule:()=>u});var s=r(1802),i=r(7153),n=r(6249),o=r(2485),l=e([o]);o=(l.then?(await l)():l)[0];let c=(0,n.l)(o,"default"),p=(0,n.l)(o,"config"),u=new s.PagesAPIRouteModule({definition:{kind:i.x.PAGES_API,page:"/api/newsletter-update/[filename]",pathname:"/api/newsletter-update/[filename]",bundlePath:"",filename:""},userland:o});a()}catch(e){a(e)}})},4810:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.d(t,{I:()=>p,db:()=>c});var s=r(3745),i=r(1492),n=r(401),o=e([s,i,n]);[s,i,n]=o.then?(await o)():o;let l=0===(0,s.getApps)().length?(0,s.initializeApp)({apiKey:"AIzaSyA6kCmSqaBH5SUPb4PkHU1hwe0l5Ppqw2w",authDomain:"logbase-blog-83db6.firebaseapp.com",projectId:"logbase-blog-83db6",storageBucket:"logbase-blog-83db6.firebasestorage.app",messagingSenderId:"938632982963",appId:"1:938632982963:web:6159f776e4466bf74bdbc6"}):(0,s.getApps)()[0],c=(0,i.getFirestore)(l),p=(0,n.getAuth)(l);a()}catch(e){a(e)}})},2485:(e,t,r)=>{r.a(e,async(e,a)=>{try{r.r(t),r.d(t,{default:()=>m});var s=r(3292),i=r.n(s),n=r(1017),o=r.n(n),l=r(4810),c=r(1492),p=r(9648),u=r(295),d=e([l,c,p,u]);async function m(e,t){if("PUT"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{filename:r}=e.query,{title:a,content:s,url:n,sentDate:d,recipients:m}=e.body;if(!r||"string"!=typeof r)return t.status(400).json({success:!1,message:"파일명이 필요합니다."});if(!a?.trim()||!s?.trim()||!d)return t.status(400).json({success:!1,message:"제목, 내용, 발송일을 모두 입력해주세요."});if(!m||0===m.length)return t.status(400).json({success:!1,message:"수신자를 한 명 이상 선택해주세요."});let g=o().resolve(process.cwd(),"public/newsletters"),f=o().join(g,"newsletters.json");try{let e=await i().readFile(f,"utf-8"),g=JSON.parse(e);if(!Array.isArray(g))return t.status(404).json({success:!1,message:"뉴스레터 목록을 찾을 수 없습니다."});let b=g.findIndex(e=>e.filename===r);if(-1===b)return t.status(404).json({success:!1,message:"뉴스레터를 찾을 수 없습니다."});let h=g[b],y=h.htmlFilePath,w=o().resolve(process.cwd(),"public",y.replace(/^\//,"")),x=o().resolve(process.cwd(),"public/news_letter_template.html"),A=await i().readFile(x,"utf-8");A=A.replace(/{{제목}}/g,a).replace(/{{발송일}}/g,new Date(d).toLocaleDateString("ko-KR")).replace(/{{본문 내용 들어가는 곳}}/g,s.replace(/\n/g,"<br>"));let P="";if(n&&n.trim())try{let{data:e}=await p.default.get(n,{timeout:5e3,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}}),t=u.load(e),r=t('meta[property="og:image"]').attr("content")||t('meta[name="twitter:image"]').attr("content")||"",a=t('meta[property="og:title"]').attr("content")||t("title").text()||"",s=t('meta[property="og:description"]').attr("content")||t('meta[name="description"]').attr("content")||"";a&&(P=`
      <!-- URL 인사이트 영역 시작 -->
      <tr>
        <td style="padding: 20px; background-color: #f8fafc; border-radius: 6px; margin: 20px 0;">
          <h3 style="font-size: 18px; color: #111; margin-bottom: 16px;">LOGBASE INSIGHT</h3>
          <div style="display: flex; align-items: flex-start; gap: 16px;">
            ${r?`<img src="${r}" alt="Insight Image" style="width: 200px; min-width: 120px; border-radius: 4px; object-fit: cover; display: block;" />`:""}
            <div style="flex: 1;">
              <h4 style="margin-top: 0; margin-bottom: 6px; color: #111;">${a}</h4>
              <p style="margin: 0; font-size: 14px; color: #444;">${s}</p>
            </div>
          </div>
        </td>
      </tr>
      <!-- URL 인사이트 영역 끝 -->`)}catch(e){}A=A.replace("{{URL_INSIGHT_SECTION}}",P);let S="";try{let e=(0,c.collection)(l.db,"rss_items"),t=(0,c.query)(e,(0,c.where)("news_letter_sent_date","==",d));for(let e of(await (0,c.getDocs)(t)).docs.map(e=>e.data())){let t=new Date(e.pubDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),r=e.author||e.creator||"Unknown";S+=`<li><a href="${e.link}" style="color:#0041C4; text-decoration:none;" target="_blank"><strong>${e.title}</strong></a><br>${r} — ${t}</li>`}}catch(e){S="<li>Error loading blog posts from database.</li>"}S||(S="<li>No articles found for this date.</li>");let j=A=A.replace("{{BEHAVIORAL_DATA_UPDATES}}",S);await i().writeFile(w,j,"utf-8");let I={...h,title:a,content:s,url:n||"",sentDate:d,recipients:m};g[b]=I;let _=o().join(process.cwd(),"functions","public","newsletters","newsletters.json");await i().writeFile(f,JSON.stringify(g,null,2),"utf-8");try{await i().writeFile(_,JSON.stringify(g,null,2),"utf-8")}catch(e){}return t.status(200).json({success:!0,message:"뉴스레터가 성공적으로 수정되었습니다!",data:{filename:r,title:a,htmlUrl:`/${y}`}})}catch(e){return t.status(404).json({success:!1,message:"뉴스레터를 찾을 수 없거나 수정할 수 없습니다.",error:e instanceof Error?e.message:"알 수 없는 오류"})}}catch(e){return t.status(500).json({success:!1,message:"뉴스레터 수정에 실패했습니다.",error:e instanceof Error?e.message:"알 수 없는 오류"})}}[l,c,p,u]=d.then?(await d)():d,a()}catch(e){a(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=7014);module.exports=r})();