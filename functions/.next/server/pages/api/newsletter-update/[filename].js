"use strict";(()=>{var e={};e.id=9786,e.ids=[9786],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},629:e=>{e.exports=require("fs/promises")},5315:e=>{e.exports=require("path")},9648:e=>{e.exports=import("axios")},295:e=>{e.exports=import("cheerio")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,r){return r in t?t[r]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,r)):"function"==typeof t&&"default"===r?t:void 0}}})},7014:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{config:()=>p,default:()=>c,routeModule:()=>u});var o=r(1802),a=r(7153),n=r(6249),i=r(2485),l=e([i]);i=(l.then?(await l)():l)[0];let c=(0,n.l)(i,"default"),p=(0,n.l)(i,"config"),u=new o.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/newsletter-update/[filename]",pathname:"/api/newsletter-update/[filename]",bundlePath:"",filename:""},userland:i});s()}catch(e){s(e)}})},5980:(e,t,r)=>{r.d(t,{Hf:()=>n,iW:()=>a});let s=require("firebase-admin");var o=r.n(s);!function(){if(o().apps.length>0)return o().app();let e={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,privateKey:process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n"),clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL},t=process.env.FIREBASE_STORAGE_EMULATOR_HOST?"logbase-blog-83db6.appspot.com":"logbase-blog-83db6.firebasestorage.app";e.privateKey?o().initializeApp({credential:o().credential.cert(e),storageBucket:t}):(console.warn("Firebase Admin private key is not set. Using default credentials."),o().initializeApp({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID||"logbase-blog-83db6",storageBucket:t}))}();let a=o().firestore(),n=o().storage().bucket(),i=process.env.FIRESTORE_EMULATOR_HOST,l=process.env.FIREBASE_STORAGE_EMULATOR_HOST;i&&(console.log(`✅ [Admin SDK] Firestore Emulator 연결: ${i}`),console.log("   환경 변수를 통해 자동 연결되었습니다.")),l&&(console.log(`✅ [Admin SDK] Storage Emulator 설정: ${l}`),console.log("   환경 변수를 통해 자동 연결되었습니다."))},4810:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.d(t,{I:()=>u,db:()=>p,l:()=>c});var o=r(3745),a=r(1492),n=r(401),i=e([o,a,n]);[o,a,n]=i.then?(await i)():i;let l={apiKey:"AIzaSyA6kCmSqaBH5SUPb4PkHU1hwe0l5Ppqw2w",authDomain:"logbase-blog-83db6.firebaseapp.com",projectId:"logbase-blog-83db6",storageBucket:"logbase-blog-83db6.firebasestorage.app",messagingSenderId:"938632982963",appId:"1:938632982963:web:6159f776e4466bf74bdbc6"};if(!l.apiKey||!l.projectId)throw Error("Firebase 설정이 올바르지 않습니다. .env.local 파일에 NEXT_PUBLIC_FIREBASE_ 환경 변수를 확인해주세요.");let c=0===(0,o.getApps)().length?(0,o.initializeApp)(l):(0,o.getApps)()[0],p=(0,a.getFirestore)(c),u=(0,n.getAuth)(c);s()}catch(e){s(e)}})},2485:(e,t,r)=>{r.a(e,async(e,s)=>{try{r.r(t),r.d(t,{default:()=>E});var o=r(629),a=r.n(o),n=r(5315),i=r.n(n),l=r(4810),c=r(1492),p=r(9648),u=r(295),g=r(5980),d=e([l,c,p,u]);async function E(e,t){if("PUT"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{filename:r}=e.query,{title:s,content:o,url:n,sentDate:d,recipients:E}=e.body;if(!r||"string"!=typeof r)return t.status(400).json({success:!1,message:"파일명이 필요합니다."});if(!s?.trim()||!o?.trim()||!d)return t.status(400).json({success:!1,message:"제목, 내용, 발송일을 모두 입력해주세요."});if(!E||0===E.length)return t.status(400).json({success:!1,message:"수신자를 한 명 이상 선택해주세요."});let f=i().resolve(process.cwd(),"public/newsletters"),m=i().join(f,"newsletters.json");try{let e=[],f=process.env.FIREBASE_CONFIG||process.env.FUNCTION_TARGET;if(f){console.log("[NEWSLETTER-UPDATE] Firebase Functions 환경에서 Cloud Storage 사용");try{let r=g.Hf.file("newsletters/newsletters.json"),[s]=await r.exists();if(!s)return console.log("[NEWSLETTER-UPDATE] Cloud Storage에 newsletters.json 파일이 없습니다."),t.status(404).json({success:!1,message:"뉴스레터 목록을 찾을 수 없습니다."});{let[t]=await r.download(),s=t.toString("utf-8");e=JSON.parse(s),Array.isArray(e)||(e=[]),console.log(`[NEWSLETTER-UPDATE] Cloud Storage에서 ${e.length}개 뉴스레터 로드`)}}catch(e){return console.error("[NEWSLETTER-UPDATE] Cloud Storage 읽기 실패:",e),t.status(404).json({success:!1,message:"뉴스레터 목록을 찾을 수 없습니다."})}}else{console.log("[NEWSLETTER-UPDATE] 로컬 환경에서 로컬 파일 사용");let t=await a().readFile(m,"utf-8");e=JSON.parse(t),Array.isArray(e)||(e=[]),console.log(`[NEWSLETTER-UPDATE] 로컬 파일에서 ${e.length}개 뉴스레터 로드`)}if(!Array.isArray(e))return t.status(404).json({success:!1,message:"뉴스레터 목록을 찾을 수 없습니다."});let A=e.findIndex(e=>e.filename===r);if(-1===A)return t.status(404).json({success:!1,message:"뉴스레터를 찾을 수 없습니다."});let b=e[A],T=b.htmlFilePath,S=i().resolve(process.cwd(),"public",T.replace(/^\//,"")),w=i().resolve(process.cwd(),"public/news_letter_template.html"),h=await a().readFile(w,"utf-8");h=h.replace(/{{제목}}/g,s).replace(/{{발송일}}/g,new Date(d).toLocaleDateString("ko-KR")).replace(/{{본문 내용 들어가는 곳}}/g,o.replace(/\n/g,"<br>"));let y="";if(n&&n.trim())try{let{data:e}=await p.default.get(n,{timeout:5e3,headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.124 Safari/537.36"}}),t=u.load(e),r=t('meta[property="og:image"]').attr("content")||t('meta[name="twitter:image"]').attr("content")||"",s=t('meta[property="og:title"]').attr("content")||t("title").text()||"",o=t('meta[property="og:description"]').attr("content")||t('meta[name="description"]').attr("content")||"";s&&(y=`
      <!-- URL 인사이트 영역 시작 -->
      <tr>
        <td style="padding: 20px; background-color: #f8fafc; border-radius: 6px; margin: 20px 0;">
          <h3 style="font-size: 18px; color: #111; margin-bottom: 16px;">LOGBASE INSIGHT</h3>
          <div style="display: flex; align-items: flex-start; gap: 16px;">
            ${r?`<img src="${r}" alt="Insight Image" style="width: 200px; min-width: 120px; border-radius: 4px; object-fit: cover; display: block;" />`:""}
            <div style="flex: 1;">
              <h4 style="margin-top: 0; margin-bottom: 6px; color: #111;">${s}</h4>
              <p style="margin: 0; font-size: 14px; color: #444;">${o}</p>
            </div>
          </div>
        </td>
      </tr>
      <!-- URL 인사이트 영역 끝 -->`)}catch(e){}h=h.replace("{{URL_INSIGHT_SECTION}}",y);let P="";try{let e=(0,c.collection)(l.db,"rss_items"),t=(0,c.query)(e,(0,c.where)("news_letter_sent_date","==",d));for(let e of(await (0,c.getDocs)(t)).docs.map(e=>e.data())){let t=new Date(e.pubDate).toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"}),r=e.author||e.creator||"Unknown";P+=`<li><a href="${e.link}" style="color:#0041C4; text-decoration:none;" target="_blank"><strong>${e.title}</strong></a><br>${r} — ${t}</li>`}}catch(e){P="<li>Error loading blog posts from database.</li>"}P||(P="<li>No articles found for this date.</li>");let _=h=h.replace("{{BEHAVIORAL_DATA_UPDATES}}",P),I={...b,title:s,content:o,url:n||"",sentDate:d,recipients:E};if(e[A]=I,f){console.log("[NEWSLETTER-UPDATE] Firebase Functions 환경에서 Cloud Storage 사용");try{let t=`newsletters/${r}.html`,s=g.Hf.file(t);await s.save(_,{metadata:{contentType:"text/html",cacheControl:"public, max-age=3600"}}),console.log(`[NEWSLETTER-UPDATE] Cloud Storage HTML 파일 저장 완료: ${t}`);let o=g.Hf.file("newsletters/newsletters.json");await o.save(JSON.stringify(e,null,2),{metadata:{contentType:"application/json"}}),console.log("[NEWSLETTER-UPDATE] Cloud Storage newsletters.json 업데이트 완료")}catch(e){throw console.error("[NEWSLETTER-UPDATE] Cloud Storage 저장 실패:",e),Error("Cloud Storage 저장 실패")}}else{console.log("[NEWSLETTER-UPDATE] 로컬 환경에서 로컬 파일 사용"),await a().writeFile(S,_,"utf-8"),await a().writeFile(m,JSON.stringify(e,null,2),"utf-8");let t=i().join(process.cwd(),"functions","public","newsletters","newsletters.json");try{await a().writeFile(t,JSON.stringify(e,null,2),"utf-8")}catch(e){}}return t.status(200).json({success:!0,message:"뉴스레터가 성공적으로 수정되었습니다!",data:{filename:r,title:s,htmlUrl:`/${T}`}})}catch(e){return t.status(404).json({success:!1,message:"뉴스레터를 찾을 수 없거나 수정할 수 없습니다.",error:e instanceof Error?e.message:"알 수 없는 오류"})}}catch(e){return t.status(500).json({success:!1,message:"뉴스레터 수정에 실패했습니다.",error:e instanceof Error?e.message:"알 수 없는 오류"})}}[l,c,p,u]=d.then?(await d)():d,s()}catch(e){s(e)}})},7153:(e,t)=>{var r;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return r}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(r||(r={}))},1802:(e,t,r)=>{e.exports=r(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var r=t(t.s=7014);module.exports=r})();