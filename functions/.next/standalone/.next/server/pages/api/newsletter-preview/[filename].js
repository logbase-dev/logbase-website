"use strict";(()=>{var e={};e.id=5237,e.ids=[5237],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},1464:(e,t,o)=>{o.r(t),o.d(t,{config:()=>E,default:()=>c,routeModule:()=>u});var s={};o.r(s),o.d(s,{default:()=>i});var r=o(1802),n=o(7153),a=o(6249),l=o(5980);async function i(e,t){if("GET"!==e.method)return t.status(405).json({message:"Method not allowed"});try{let{filename:o}=e.query;if(!o||"string"!=typeof o)return t.status(400).json({success:!1,message:"파일명이 필요합니다."});console.log(`[PREVIEW] 미리보기 요청 시작: ${o}`),console.log(`[PREVIEW] Admin Bucket 확인:`,l.Hf?"초기화됨":"초기화 안됨");let s=`newsletters/${o}.html`,r=l.Hf.file(s);console.log(`[PREVIEW] Cloud Storage에서 파일 요청: ${s}`);try{console.log(`[PREVIEW] 파일 존재 여부 확인 중...`);let[e]=await r.exists();if(console.log(`[PREVIEW] 파일 존재 여부: ${e}`),!e)return console.log(`[PREVIEW] 파일이 존재하지 않음: ${s}`),t.status(404).json({success:!1,message:"뉴스레터 파일을 찾을 수 없습니다.",path:s});console.log(`[PREVIEW] 파일 다운로드 시작...`);let[o]=await r.download();console.log(`[PREVIEW] 파일 다운로드 성공: ${o.length} bytes`),t.setHeader("Content-Type","text/html; charset=utf-8"),t.setHeader("Cache-Control","no-cache, no-store, must-revalidate"),t.send(o)}catch(e){return console.error("[PREVIEW] 파일 다운로드 실패:",e),console.error("[PREVIEW] 에러 상세:",{message:e instanceof Error?e.message:"Unknown error",stack:e instanceof Error?e.stack:void 0,storagePath:s}),t.status(500).json({success:!1,message:"뉴스레터 파일을 불러올 수 없습니다.",error:e instanceof Error?e.message:"알 수 없는 오류"})}}catch(e){return console.error("[PREVIEW] API 오류:",e),t.status(500).json({success:!1,message:"뉴스레터 미리보기에 실패했습니다.",error:e instanceof Error?e.message:"알 수 없는 오류"})}}let c=(0,a.l)(s,"default"),E=(0,a.l)(s,"config"),u=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/newsletter-preview/[filename]",pathname:"/api/newsletter-preview/[filename]",bundlePath:"",filename:""},userland:s})},5980:(e,t,o)=>{o.d(t,{Hf:()=>a,iW:()=>n});let s=require("firebase-admin");var r=o.n(s);!function(){if(r().apps.length>0)return r().app();let e={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,privateKey:process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n"),clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL},t=process.env.FIREBASE_STORAGE_EMULATOR_HOST?"logbase-blog-83db6.appspot.com":"logbase-blog-83db6.firebasestorage.app";e.privateKey?r().initializeApp({credential:r().credential.cert(e),storageBucket:t}):(console.warn("Firebase Admin private key is not set. Using default credentials."),r().initializeApp({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID||"logbase-blog-83db6",storageBucket:t}))}();let n=r().firestore(),a=r().storage().bucket(),l=process.env.FIRESTORE_EMULATOR_HOST,i=process.env.FIREBASE_STORAGE_EMULATOR_HOST;l&&(console.log(`✅ [Admin SDK] Firestore Emulator 연결: ${l}`),console.log("   환경 변수를 통해 자동 연결되었습니다.")),i&&(console.log(`✅ [Admin SDK] Storage Emulator 설정: ${i}`),console.log("   환경 변수를 통해 자동 연결되었습니다."))},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=1464);module.exports=o})();