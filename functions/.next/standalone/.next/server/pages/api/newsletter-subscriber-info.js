"use strict";(()=>{var e={};e.id=2916,e.ids=[2916],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},4067:(e,t,o)=>{o.a(e,async(e,s)=>{try{o.r(t),o.d(t,{config:()=>u,default:()=>i,routeModule:()=>d});var r=o(1802),a=o(7153),n=o(6249),l=o(2618),c=e([l]);l=(c.then?(await c)():c)[0];let i=(0,n.l)(l,"default"),u=(0,n.l)(l,"config"),d=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/newsletter-subscriber-info",pathname:"/api/newsletter-subscriber-info",bundlePath:"",filename:""},userland:l});s()}catch(e){s(e)}})},4810:(e,t,o)=>{o.a(e,async(e,s)=>{try{o.d(t,{I:()=>d,db:()=>u,l:()=>i});var r=o(3745),a=o(1492),n=o(401),l=e([r,a,n]);[r,a,n]=l.then?(await l)():l;let c={apiKey:"AIzaSyA6kCmSqaBH5SUPb4PkHU1hwe0l5Ppqw2w",authDomain:"logbase-blog-83db6.firebaseapp.com",projectId:"logbase-blog-83db6",storageBucket:"logbase-blog-83db6.firebasestorage.app",messagingSenderId:"938632982963",appId:"1:938632982963:web:6159f776e4466bf74bdbc6"};if(!c.apiKey||!c.projectId)throw Error("Firebase 설정이 올바르지 않습니다. .env.local 파일에 NEXT_PUBLIC_FIREBASE_ 환경 변수를 확인해주세요.");let i=0===(0,r.getApps)().length?(0,r.initializeApp)(c):(0,r.getApps)()[0],u=(0,a.getFirestore)(i),d=(0,n.getAuth)(i);s()}catch(e){s(e)}})},110:(e,t,o)=>{o.d(t,{S:()=>a,L:()=>n});let s=require("crypto");var r=o.n(s);function a(e){let t=process.env.UNSUBSCRIBE_SECRET||"default-secret-key";return r().createHmac("sha256",t).update(e).digest("hex").substring(0,16)}function n(e){let t=a(e),o="https://logbase.kr";if(process.env.FIREBASE_CONFIG||process.env.FUNCTION_TARGET){let e=process.env.FIREBASE_FUNCTION_URL||process.env.VERCEL_URL;o=e&&e.includes("logbase.kr")?"https://logbase.kr":e&&e.includes("localhost")?"http://localhost:3000":"https://logbase.kr"}else o="http://localhost:3000";return`${o}/unsubscribe?email=${encodeURIComponent(e)}&token=${t}`}},2618:(e,t,o)=>{o.a(e,async(e,s)=>{try{o.r(t),o.d(t,{default:()=>c});var r=o(4810),a=o(1492),n=o(110),l=e([r,a]);[r,a]=l.then?(await l)():l;let c=async(e,t)=>{if(console.log("\uD83D\uDD0D API 호출됨:",e.method,e.url),t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),"OPTIONS"===e.method){t.status(200).end();return}if("GET"===e.method)try{console.log("\uD83D\uDD0D GET 요청 처리 시작");let{email:o,token:s}=e.query;if(console.log("\uD83D\uDCE7 받은 파라미터:",{email:o,token:s}),!o||!s)return console.log("❌ 파라미터 누락"),t.status(400).json({success:!1,error:"이메일과 토큰이 필요합니다."});console.log("\uD83D\uDD10 토큰 검증 시작");let l=(0,n.S)(o);if(console.log("\uD83D\uDD11 토큰 비교:",{received:s,expected:l}),s!==l)return console.log("❌ 토큰 불일치"),t.status(401).json({success:!1,error:"유효하지 않은 토큰입니다."});console.log("✅ 토큰 검증 성공");let c=(0,a.collection)(r.db,"newsletter"),i=(0,a.query)(c,(0,a.where)("email","==",o)),u=await (0,a.getDocs)(i);if(u.empty)return t.status(404).json({success:!1,error:"구독자를 찾을 수 없습니다."});let d=u.docs[0].data();console.log("\uD83D\uDCCA 원본 구독자 데이터:",d);let p={email:d.email,name:d.name,organization:d.company,status:d.status,createdAt:d.createdAt?.toDate?.()||d.createdAt,updatedAt:d.updatedAt?.toDate?.()||d.updatedAt};console.log("\uD83D\uDCCA 안전한 구독자 데이터:",p),t.status(200).json({success:!0,data:p})}catch(e){console.error("구독자 정보 조회 에러:",e),t.status(500).json({success:!1,error:"구독자 정보를 조회할 수 없습니다."})}else t.setHeader("Allow",["GET"]),t.status(405).end(`Method ${e.method} Not Allowed`)};s()}catch(e){s(e)}})},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var o=t(t.s=4067);module.exports=o})();