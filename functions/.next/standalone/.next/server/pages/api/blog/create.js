"use strict";(()=>{var e={};e.id=2390,e.ids=[2390],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2929:e=>{e.exports=import("firebase-admin/firestore")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},8467:(e,t,o)=>{o.a(e,async(e,a)=>{try{o.r(t),o.d(t,{config:()=>p,default:()=>l,routeModule:()=>E});var r=o(1802),n=o(7153),s=o(6249),i=o(8902),c=e([i]);i=(c.then?(await c)():c)[0];let l=(0,s.l)(i,"default"),p=(0,s.l)(i,"config"),E=new r.PagesAPIRouteModule({definition:{kind:n.x.PAGES_API,page:"/api/blog/create",pathname:"/api/blog/create",bundlePath:"",filename:""},userland:i});a()}catch(e){a(e)}})},5980:(e,t,o)=>{o.d(t,{Hf:()=>s,iW:()=>n});let a=require("firebase-admin");var r=o.n(a);!function(){if(r().apps.length>0)return r().app();let e={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,privateKey:process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n"),clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL},t=process.env.FIREBASE_STORAGE_EMULATOR_HOST?"logbase-blog-83db6.appspot.com":"logbase-blog-83db6.firebasestorage.app";e.privateKey?r().initializeApp({credential:r().credential.cert(e),storageBucket:t}):(console.warn("Firebase Admin private key is not set. Using default credentials."),r().initializeApp({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID||"logbase-blog-83db6",storageBucket:t}))}();let n=r().firestore(),s=r().storage().bucket(),i=process.env.FIRESTORE_EMULATOR_HOST,c=process.env.FIREBASE_STORAGE_EMULATOR_HOST;i&&(console.log(`✅ [Admin SDK] Firestore Emulator 연결: ${i}`),console.log("   환경 변수를 통해 자동 연결되었습니다.")),c&&(console.log(`✅ [Admin SDK] Storage Emulator 설정: ${c}`),console.log("   환경 변수를 통해 자동 연결되었습니다."))},8902:(e,t,o)=>{o.a(e,async(e,a)=>{try{o.r(t),o.d(t,{config:()=>p,default:()=>l});var r=o(2929),n=o(5980),s=e([r]);async function i(e,t){try{let o;let a=n.Hf,r=e.match(/^data:image\/([a-z]+);base64,/),s=r?r[1]:"jpeg",i=e.replace(/^data:image\/[a-z]+;base64,/,""),c=Buffer.from(i,"base64"),l=`blog-images/${Date.now()}-${t}`,p=a.file(l);await p.save(c,{metadata:{contentType:`image/${"jpg"===s?"jpeg":s}`,cacheControl:"public, max-age=31536000"}});let E=process.env.FIREBASE_STORAGE_EMULATOR_HOST;if(E){let e=a.name||"logbase-blog-83db6.appspot.com";o=`http://${E}/v0/b/${e}/o/${encodeURIComponent(l)}?alt=media`}else{let e=encodeURIComponent(l).replace(/%2F/g,"%2F");o=`https://firebasestorage.googleapis.com/v0/b/logbase-blog-83db6.firebasestorage.app/o/${e}?alt=media`,console.log("Firebase Storage 공개 URL 사용 (Rules 기반):",o)}return console.log("이미지 업로드 완료:",o),o}catch(e){throw console.error("이미지 업로드 실패:",e),Error("이미지 업로드에 실패했습니다.")}}async function c(e){try{let t=e.match(/!\[.*?\]\(data:image\/[a-z]+;base64,[^)]+\)/g);if(!t)return e;let o=e;for(let e of t)try{let t=e.match(/!\[(.*?)\]/),a=e.match(/data:image\/([a-z]+);base64,([^)]+)/);if(t&&a){let r=t[1],n=a[1],s=a[2],c=(r||"image").replace(/\.[a-zA-Z0-9]+$/,""),l="jpg"===n?"jpeg":n,p=`${c}.${l}`,E=await i(`data:image/${n};base64,${s}`,p),d=`![${r}](${E})`;o=o.replace(e,d),console.log("이미지 처리 완료:",p,"->",E)}}catch(a){console.error("개별 이미지 처리 실패:",a);let t=e.match(/!\[([^\]]*)\]/)?.[1]||"이미지";o=o.replace(e,`![이미지 업로드 실패: ${t}]`)}return o}catch(t){return console.error("이미지 처리 중 오류:",t),e}}r=(s.then?(await s)():s)[0];let p={api:{bodyParser:{sizeLimit:"10mb"}}};async function l(e,t){if("POST"!==e.method)return t.status(405).json({error:"Method not allowed"});try{let o=e.body;if(!o.title||!o.description||!o.content)return t.status(400).json({error:"제목, 설명, 내용은 필수 항목입니다."});console.log("\uD83D\uDCDD 블로그 글 저장 시작:",{title:o.title,description:o.description.substring(0,100)+"...",contentLength:o.content.length});let a=o.content;o.content.includes("data:image/")&&(console.log("\uD83D\uDDBC️ 이미지 처리 시작..."),a=await c(o.content),console.log("✅ 이미지 처리 완료"));let s=n.iW.collection("rss_items").doc();await s.set({...o,guid:s.id,content:a,createdAt:r.FieldValue.serverTimestamp(),createdBy:"manual",source:"blog-write-page"}),console.log("✅ 블로그 글 저장 완료:",s.id),t.status(200).json({success:!0,id:s.id,message:"블로그 글이 성공적으로 저장되었습니다.",imageProcessed:a!==o.content})}catch(o){console.error("❌ 블로그 글 저장 오류:",o);let e={env:{FIREBASE_ADMIN_PROJECT_ID:!!process.env.FIREBASE_ADMIN_PROJECT_ID,FIREBASE_ADMIN_PRIVATE_KEY_ID:!!process.env.FIREBASE_ADMIN_PRIVATE_KEY_ID,FIREBASE_ADMIN_PRIVATE_KEY:!!process.env.FIREBASE_ADMIN_PRIVATE_KEY,FIREBASE_ADMIN_CLIENT_EMAIL:!!process.env.FIREBASE_ADMIN_CLIENT_EMAIL,FIREBASE_ADMIN_CLIENT_ID:!!process.env.FIREBASE_ADMIN_CLIENT_ID},errorName:o?.name,errorCode:o?.code,errorMessage:o?.message,errorStack:"string"==typeof o?.stack?String(o.stack).split("\n").slice(0,5):void 0};t.status(500).json({error:"블로그 글 저장에 실패했습니다.",details:e})}}a()}catch(e){a(e)}})},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=8467);module.exports=o})();