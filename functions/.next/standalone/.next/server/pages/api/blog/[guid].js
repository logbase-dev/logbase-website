"use strict";(()=>{var e={};e.id=7921,e.ids=[7921],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},2929:e=>{e.exports=import("firebase-admin/firestore")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,o){return o in t?t[o]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,o)):"function"==typeof t&&"default"===o?t:void 0}}})},3894:(e,t,o)=>{o.a(e,async(e,s)=>{try{o.r(t),o.d(t,{config:()=>g,default:()=>c,routeModule:()=>p});var l=o(1802),r=o(7153),a=o(6249),i=o(3431),n=e([i]);i=(n.then?(await n)():n)[0];let c=(0,a.l)(i,"default"),g=(0,a.l)(i,"config"),p=new l.PagesAPIRouteModule({definition:{kind:r.x.PAGES_API,page:"/api/blog/[guid]",pathname:"/api/blog/[guid]",bundlePath:"",filename:""},userland:i});s()}catch(e){s(e)}})},5980:(e,t,o)=>{o.d(t,{Hf:()=>a,iW:()=>r});let s=require("firebase-admin");var l=o.n(s);!function(){if(l().apps.length>0)return l().app();let e={projectId:process.env.FIREBASE_ADMIN_PROJECT_ID,privateKey:process.env.FIREBASE_ADMIN_PRIVATE_KEY?.replace(/\\n/g,"\n"),clientEmail:process.env.FIREBASE_ADMIN_CLIENT_EMAIL},t=process.env.FIREBASE_STORAGE_EMULATOR_HOST?"logbase-blog-83db6.appspot.com":"logbase-blog-83db6.firebasestorage.app";e.privateKey?l().initializeApp({credential:l().credential.cert(e),storageBucket:t}):(console.warn("Firebase Admin private key is not set. Using default credentials."),l().initializeApp({projectId:process.env.FIREBASE_ADMIN_PROJECT_ID||"logbase-blog-83db6",storageBucket:t}))}();let r=l().firestore(),a=l().storage().bucket(),i=process.env.FIRESTORE_EMULATOR_HOST,n=process.env.FIREBASE_STORAGE_EMULATOR_HOST;i&&(console.log(`✅ [Admin SDK] Firestore Emulator 연결: ${i}`),console.log("   환경 변수를 통해 자동 연결되었습니다.")),n&&(console.log(`✅ [Admin SDK] Storage Emulator 설정: ${n}`),console.log("   환경 변수를 통해 자동 연결되었습니다."))},3431:(e,t,o)=>{o.a(e,async(e,s)=>{try{o.r(t),o.d(t,{default:()=>i});var l=o(5980),r=o(2929),a=e([r]);async function i(e,t){let{guid:o}=e.query;if(!o)return t.status(400).json({success:!1,error:"GUID is required"});switch(e.method){case"GET":try{let e=l.iW.collection("rss_items").doc(o),s=await e.get();if(!s.exists)return t.status(404).json({success:!1,error:"Article not found"});let r=s.data(),a=r.content||"";if(r.content){if(console.log("\uD83D\uDD0D 원본 content:",r.content),process.env.FIREBASE_STORAGE_EMULATOR_HOST)console.log("✅ 로컬 환경 - 원본 content 그대로 사용 (URL 처리 건너뛰기)"),a=r.content;else try{let e=l.Hf,t=e=>{let t=encodeURIComponent(e).replace(/%2F/g,"%2F");return`https://firebasestorage.googleapis.com/v0/b/logbase-blog-83db6.firebasestorage.app/o/${t}?alt=media`},o=r.content.match(/!\[.*?\]\((http:\/\/127\.0\.0\.1:9199\/v0\/b\/[^)]+blog-images[^)]+)\)/g);if(console.log("\uD83D\uDD0D Emulator URL 매칭 결과:",o),o)for(let s of o){let o=s.match(/!\[(.*?)\]\((http:\/\/127\.0\.0\.1:9199\/v0\/b\/[^)]+blog-images[^)]+)\)/);if(o){let l=o[1],r=o[2];console.log("\uD83D\uDD0D Emulator URL 처리:",{altText:l,oldUrl:r});let i="";if(r.includes("blog-images%2F")){let e=r.split("blog-images%2F");if(e.length>1){let t=e[1].split("?")[0];i=`blog-images/${decodeURIComponent(t)}`}}else if(r.includes("blog-images/")){let e=r.split("blog-images/");if(e.length>1){let t=e[1].split("?")[0];i=`blog-images/${t}`}}if(console.log("\uD83D\uDD0D 추출된 filePath:",i),i)try{let[o]=await e.file(i).exists(),r=i;if(!o){let t=await e.getFiles({prefix:"blog-images/"}),o=i.split("/").pop()||"",s=decodeURIComponent(o);for(let e of t[0]){let t=e.name.split("/").pop()||"";if(t===o||t===s||t.endsWith(s)){r=e.name;break}}}let n=t(r),c=`![${l}](${n})`;a=a?.replace(s,c)||a,console.log("✅ 이미지 URL 갱신:",r,"->",n)}catch(r){console.warn("파일 존재 확인 실패, 원본 경로 사용:",i,r);let e=t(i),o=`![${l}](${e})`;a=a?.replace(s,o)||a}}}let s=r.content.match(/!\[.*?\]\((https:\/\/[^)]+blog-images\/[^)]+)\)/g);if(s)for(let e of s){let o=e.match(/!\[(.*?)\]\((https:\/\/[^)]+blog-images\/[^)]+)\)/);if(o){let s=o[1],l=o[2].split("blog-images/");if(l.length>1){let o=`blog-images/${l[1].split("?")[0]}`,r=t(o),i=`![${s}](${r})`;a=a?.replace(e,i)||a,console.log("이미지 URL 갱신 (공개 URL):",o,"->",r)}}}let i=r.content.match(/!\[.*?\]\(([^)]+\.(jpg|jpeg|png|gif|webp|svg))\)/g);if(console.log("\uD83D\uDD0D 파일명 패턴 매칭 결과:",i),i)for(let o of i){let s=o.match(/!\[(.*?)\]\(([^)]+\.(jpg|jpeg|png|gif|webp|svg))\)/);if(s){let l=s[1],r=s[2],i=r.startsWith("blog-images/")?r:`blog-images/${r}`;try{let s=await e.getFiles({prefix:"blog-images/"}),n=i,c=!1,g=r.replace(/^blog-images\//,"");for(let e of(console.log("\uD83D\uDD0D 검색할 기본 파일명:",g),console.log("\uD83D\uDD0D Storage에 있는 파일들:",s[0].map(e=>e.name)),s[0])){let t=e.name.split("/").pop()||"";if(console.log("\uD83D\uDD0D 비교 중:",t,"endsWith",g,"?",t.endsWith(g)),t.endsWith(g)){n=e.name,c=!0,console.log("✅ 파일 찾음:",n);break}}if(c){let e=t(n),s=`![${l}](${e})`;a=a?.replace(o,s)||a,console.log("이미지 URL 갱신 (파일명):",n,"->",e)}else console.warn("파일이 존재하지 않음:",i)}catch(e){console.error("이미지 URL 갱신 실패:",i,e)}}}}catch(e){console.error("이미지 URL 처리 중 오류:",e)}}let i=JSON.parse(JSON.stringify({...r,content:a,id:s.id,createdAt:r.createdAt?.toDate?r.createdAt.toDate().toISOString():r.createdAt,updatedAt:r.updatedAt?.toDate?r.updatedAt.toDate().toISOString():r.updatedAt}));return t.status(200).json({success:!0,data:i})}catch(e){return console.error(`Error fetching article (guid: ${o}):`,e),t.status(500).json({success:!1,error:"Failed to fetch article"})}case"PUT":try{let s=l.iW.collection("rss_items").doc(o);if(!(await s.get()).exists)return t.status(404).json({success:!1,error:"Article not found for update"});let a={...e.body,updatedAt:r.FieldValue.serverTimestamp()};return void 0===e.body.content&&delete a.content,await s.update(a),t.status(200).json({success:!0,guid:o})}catch(e){return console.error(`Error updating article (guid: ${o}):`,e),t.status(500).json({success:!1,error:"Failed to update article"})}default:return t.setHeader("Allow",["GET","PUT"]),t.status(405).end(`Method ${e.method} Not Allowed`)}}r=(a.then?(await a)():a)[0],s()}catch(e){s(e)}})},7153:(e,t)=>{var o;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return o}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(o||(o={}))},1802:(e,t,o)=>{e.exports=o(145)}};var t=require("../../../webpack-api-runtime.js");t.C(e);var o=t(t.s=3894);module.exports=o})();