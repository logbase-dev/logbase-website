"use strict";(()=>{var e={};e.id=751,e.ids=[751],e.modules={145:e=>{e.exports=require("next/dist/compiled/next-server/pages-api.runtime.prod.js")},3745:e=>{e.exports=import("firebase/app")},401:e=>{e.exports=import("firebase/auth")},1492:e=>{e.exports=import("firebase/firestore")},6249:(e,t)=>{Object.defineProperty(t,"l",{enumerable:!0,get:function(){return function e(t,s){return s in t?t[s]:"then"in t&&"function"==typeof t.then?t.then(t=>e(t,s)):"function"==typeof t&&"default"===s?t:void 0}}})},5934:(e,t,s)=>{s.a(e,async(e,o)=>{try{s.r(t),s.d(t,{config:()=>p,default:()=>c,routeModule:()=>d});var r=s(1802),a=s(7153),n=s(6249),i=s(8273),l=e([i]);i=(l.then?(await l)():l)[0];let c=(0,n.l)(i,"default"),p=(0,n.l)(i,"config"),d=new r.PagesAPIRouteModule({definition:{kind:a.x.PAGES_API,page:"/api/newsletter-to-slack",pathname:"/api/newsletter-to-slack",bundlePath:"",filename:""},userland:i});o()}catch(e){o(e)}})},4810:(e,t,s)=>{s.a(e,async(e,o)=>{try{s.d(t,{I:()=>d,db:()=>p,l:()=>c});var r=s(3745),a=s(1492),n=s(401),i=e([r,a,n]);[r,a,n]=i.then?(await i)():i;let l={apiKey:"AIzaSyA6kCmSqaBH5SUPb4PkHU1hwe0l5Ppqw2w",authDomain:"logbase-blog-83db6.firebaseapp.com",projectId:"logbase-blog-83db6",storageBucket:"logbase-blog-83db6.firebasestorage.app",messagingSenderId:"938632982963",appId:"1:938632982963:web:6159f776e4466bf74bdbc6"};if(!l.apiKey||!l.projectId)throw Error("Firebase 설정이 올바르지 않습니다. .env.local 파일에 NEXT_PUBLIC_FIREBASE_ 환경 변수를 확인해주세요.");let c=0===(0,r.getApps)().length?(0,r.initializeApp)(l):(0,r.getApps)()[0],p=(0,a.getFirestore)(c),d=(0,n.getAuth)(c);o()}catch(e){o(e)}})},8273:(e,t,s)=>{s.a(e,async(e,o)=>{try{s.r(t),s.d(t,{default:()=>i});var r=s(1492),a=s(4810),n=e([r,a]);[r,a]=n.then?(await n)():n;let l=process.env.SLACK_NEWSLETTER_WEBHOOK_URL||"https://hooks.slack.com/services/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";async function i(e,t){if(t.setHeader("Access-Control-Allow-Origin","*"),t.setHeader("Access-Control-Allow-Methods","GET, POST, PUT, DELETE, OPTIONS"),t.setHeader("Access-Control-Allow-Headers","Content-Type, Authorization"),"OPTIONS"===e.method){t.status(200).end();return}if("POST"!==e.method)return t.setHeader("Allow",["POST"]),t.status(405).json({error:`Method ${e.method} Not Allowed`});try{let{name:s,email:o,company:n,phone:i}=e.body;if(!s||!o)return t.status(400).json({success:!1,error:"이름과 이메일은 필수 항목입니다."});if(!/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(o))return t.status(400).json({success:!1,error:"올바른 이메일 형식을 입력해주세요."});let c={text:"\uD83C\uDD95 새로운 뉴스레터 신청이 도착했습니다!",blocks:[{type:"header",text:{type:"plain_text",text:"\uD83D\uDCE7 뉴스레터 신청"}},{type:"section",fields:[{type:"mrkdwn",text:`*이름:*
${s}`},{type:"mrkdwn",text:`*이메일:*
${o}`}]}]};if(n||i){let e=[];n&&e.push({type:"mrkdwn",text:`*회사/소속:*
${n}`}),i&&e.push({type:"mrkdwn",text:`*연락처:*
${i}`}),c.blocks.push({type:"section",fields:e})}c.blocks.push({type:"divider"}),c.blocks.push({type:"context",elements:[{type:"mrkdwn",text:`신청 시간: ${new Date().toLocaleString("ko-KR",{timeZone:"Asia/Seoul"})}`}]});let p={name:s,email:o,company:n||"",phone:i||"",createdAt:(0,r.serverTimestamp)(),status:"active"},d=!1;try{let e=(0,r.collection)(a.db,"newsletter"),t=(0,r.query)(e,(0,r.where)("email","==",o)),l=await (0,r.getDocs)(t);if(l.empty)await (0,r.addDoc)(e,p),console.log("✅ 새로운 구독자 추가 완료");else{let e=l.docs[0].id,t=(0,r.doc)(a.db,"newsletter",e);await (0,r.updateDoc)(t,{name:s,company:n||"",phone:i||"",updatedAt:(0,r.serverTimestamp)(),status:"active"}),console.log("✅ 기존 구독자 정보 업데이트 완료")}d=!0}catch(e){console.error("❌ Firestore 저장 실패:",e)}let u=!1;if(l)try{let e=await fetch(l,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!e.ok)throw console.error("Slack 전송 실패:",e.status,e.statusText),Error("Slack 메시지 전송에 실패했습니다.");console.log("✅ Slack 메시지 전송 성공"),u=!0}catch(e){console.error("❌ Slack 전송 오류:",e)}else console.warn("⚠️ SLACK_WEBHOOK_URL이 설정되지 않았습니다.");if(d||u){let e=[];d&&e.push("구독자 정보 저장"),u&&e.push("Slack 알림 전송"),t.status(200).json({success:!0,message:`뉴스레터 신청이 성공적으로 처리되었습니다. (${e.join(", ")} 완료)`})}else throw Error("모든 처리가 실패했습니다.")}catch(e){console.error("❌ 뉴스레터 신청 처리 오류:",e),t.status(500).json({success:!1,error:"뉴스레터 신청 처리 중 오류가 발생했습니다."})}}o()}catch(e){o(e)}})},7153:(e,t)=>{var s;Object.defineProperty(t,"x",{enumerable:!0,get:function(){return s}}),function(e){e.PAGES="PAGES",e.PAGES_API="PAGES_API",e.APP_PAGE="APP_PAGE",e.APP_ROUTE="APP_ROUTE"}(s||(s={}))},1802:(e,t,s)=>{e.exports=s(145)}};var t=require("../../webpack-api-runtime.js");t.C(e);var s=t(t.s=5934);module.exports=s})();