(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[185],{6470:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/write",function(){return r(9912)}])},9912:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return w}});var s=r(5893),a=r(645),o=r.n(a),n=r(7294),i=r(1163),l=r(9008),c=r.n(l),d=r(837),m=r(5152),_=r.n(m),u=r(361),h=r.n(u);let g=_()(()=>r.e(725).then(r.bind(r,4725)),{loadableGenerated:{webpack:()=>[4725]},ssr:!1});function w(){var e;let t;let r=(0,i.useRouter)(),{user:a}=(0,d.a)(),l=(0,n.useRef)(null),[m,_]=(0,n.useState)(null),[u,w]=(0,n.useState)({title:"",description:"",content:"",link:"",blogName:"Logbase Blog",feedType:"logbase",keywords:[],author:(null==a?void 0:a.email)||""}),[f,p]=(0,n.useState)(!1),[x,j]=(0,n.useState)(null),[b,v]=(0,n.useState)(null),[y,k]=(0,n.useState)(!1),[N,S]=(0,n.useState)(!1),[C,D]=(0,n.useState)(""),[I,M]=(0,n.useState)("wysiwyg"),[L,T]=(0,n.useState)(0),[B,E]=(0,n.useState)(0),[R,A]=(0,n.useState)(!1),[F,O]=(0,n.useState)(!1),[H,G]=(0,n.useState)(!1),[U,K]=(0,n.useState)(!1),[J,P]=(0,n.useState)([]),[z,Y]=(0,n.useState)(!1);(0,n.useEffect)(()=>{S(!0)},[]),(0,n.useEffect)(()=>{let e=localStorage.getItem("blog-drafts");if(e)try{P(JSON.parse(e))}catch(e){console.error("임시저장 데이터 로드 실패:",e)}},[]);let q=(0,n.useCallback)(async()=>{if(u.title||u.content){O(!0);try{let e="draft-".concat(Date.now()),t=[{id:e,title:u.title,description:u.description,content:u.content,keywords:u.keywords,author:u.author,savedAt:new Date().toISOString()},...J.filter(t=>t.id!==e)].slice(0,10);P(t),localStorage.setItem("blog-drafts",JSON.stringify(t)),G(!0),setTimeout(()=>G(!1),3e3)}catch(e){console.error("임시저장 실패:",e)}finally{O(!1)}}},[u,J]),V=(0,n.useCallback)((e=()=>{if(m&&y)try{let e=m.getMarkdown(),t=m.getHTML()||"";w(t=>({...t,content:e}));let r=t.replace(/<[^>]*>/g,"").trim();E(r.length),T(r.split(/\s+/).filter(e=>e.length>0).length)}catch(e){console.error("에디터 내용 가져오기 실패:",e)}},function(){for(var r=arguments.length,s=Array(r),a=0;a<r;a++)s[a]=arguments[a];clearTimeout(t),t=setTimeout(()=>e(...s),300)}),[y,m]),W=(0,n.useCallback)(()=>{console.log("\uD83D\uDCDD 에디터 변경 감지"),y||k(!0),V()},[V,y]),X=e=>{w(t=>({...t,title:e.title,description:e.description,content:e.content,keywords:e.keywords,author:e.author}));let t=()=>{if(m)try{return m.reset(),m.setMarkdown(e.content),console.log("✅ 임시저장 내용을 에디터에 설정했습니다."),!0}catch(t){console.error("방법 1 실패:",t);try{return m.reset(),m.insertText(e.content),console.log("✅ insertText로 임시저장 내용을 설정했습니다."),!0}catch(t){console.error("방법 2 실패:",t);try{return m.exec("reset"),m.exec("addText",e.content),console.log("✅ exec으로 임시저장 내용을 설정했습니다."),!0}catch(e){console.error("방법 3 실패:",e)}}}return!1};if(!t()){let e=setInterval(()=>{t()&&clearInterval(e)},500);setTimeout(()=>{clearInterval(e),console.warn("⚠️ 에디터 내용 설정 타임아웃")},1e4)}Y(!1)},Z=e=>{let t=J.filter(t=>t.id!==e);P(t),localStorage.setItem("blog-drafts",JSON.stringify(t))},Q=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1200,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.8;return new Promise(s=>{let a=document.createElement("canvas"),o=a.getContext("2d"),n=new Image;n.onload=()=>{let{width:e,height:i}=n;e>t&&(i=i*t/e,e=t),a.width=e,a.height=i,null==o||o.drawImage(n,0,0,e,i),s(a.toDataURL("image/jpeg",r))},n.src=URL.createObjectURL(e)})},$=async e=>{if(!e.type.startsWith("image/")){j("이미지 파일만 업로드할 수 있습니다.");return}if(e.size>10485760){j("이미지 크기는 10MB 이하여야 합니다.");return}try{let t=await Q(e,1200,.8);if(m)try{let r="![".concat(e.name,"](").concat(t,")"),s=m.getMarkdown(),a=m.getSelection(),o=s.slice(0,a[0])+r+"\n\n"+s.slice(a[1]);m.setMarkdown(o),w(e=>({...e,content:o})),URL.revokeObjectURL(URL.createObjectURL(e))}catch(e){console.error("이미지 삽입 실패:",e),j("이미지 삽입에 실패했습니다.")}}catch(e){console.error("이미지 업로드 실패:",e),j("이미지 업로드에 실패했습니다.")}},ee=(0,n.useCallback)(e=>{e.preventDefault(),K(!1);let t=Array.from(e.dataTransfer.files).filter(e=>e.type.startsWith("image/"));t.length>0&&$(t[0])},[]),et=e=>{let{name:t,value:r}=e.target;w(e=>({...e,[t]:r}))},er=e=>{w(t=>({...t,keywords:t.keywords.filter((t,r)=>r!==e)}))},es=async e=>{e.preventDefault(),p(!0),j(null),v(null);try{console.log("\uD83D\uDE80 블로그 글 저장 시작");let e=(null==m?void 0:m.getMarkdown())||"";if(console.log("\uD83D\uDCCA handleSubmit에서 최종 검증 데이터:",{title:u.title,contentLength:e.length,contentPreview:e.substring(0,100)}),!u.title.trim())throw Error("제목을 입력해주세요.");if(!e.trim())throw Error("내용을 입력해주세요. 에디터에 텍스트를 입력한 후 다시 시도해주세요.");let t=e.replace(/<[^>]*>/g,"").trim(),s=t.length>200?t.substring(0,200)+"...":t,a=new Date,o=new Date(a.getTime()+324e5),n=o.toISOString(),i=o.toUTCString(),l="logbase-".concat(Date.now(),"-").concat(Math.random().toString(36).substr(2,9)),c={title:u.title,description:s,content:e,contentSnippet:s,link:"https://www.logbase.kr/blog/".concat(l),pubDate:i,isoDate:n,guid:l,blogName:"Logbase",feedType:"logbase",matchedKeywords:u.keywords,categories:u.keywords,author:u.author,creator:u.author,"dc:creator":u.author,collectedDate:n};console.log("\uD83D\uDCDD 블로그 글 저장 요청:",{title:c.title,description:c.description,contentLength:(c.content||"").length,categories:c.categories});let d=await fetch("/api/blog/create",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(c)});if(!d.ok){let e=await d.json();throw Error(e.error||"블로그 글 저장에 실패했습니다.")}let _=await d.json();console.log("✅ 블로그 글 저장 성공:",_),v("블로그 글이 성공적으로 저장되었습니다! (ID: ".concat(_.id,")"));let h=J.filter(t=>!(t.title===u.title&&t.content===e));P(h),localStorage.setItem("blog-drafts",JSON.stringify(h)),setTimeout(()=>{r.push("/rss-feed")},3e3)}catch(e){console.error("❌ 블로그 글 저장 오류:",e),j(e instanceof Error?e.message:"알 수 없는 오류가 발생했습니다.")}finally{p(!1)}};(0,n.useCallback)(()=>{A(e=>!e)},[]),(0,n.useCallback)(e=>{if(m)try{m.changeMode(e),M(e)}catch(e){console.error("에디터 모드 변경 실패:",e)}},[m]),(0,n.useCallback)(()=>{if(m)try{m.setMarkdown(""),w(e=>({...e,content:""})),T(0),E(0)}catch(e){console.error("에디터 내용 초기화 실패:",e)}},[m]);let ea=(0,n.useCallback)(e=>{e.preventDefault(),K(!0)},[]),eo=(0,n.useCallback)(e=>{e.preventDefault(),K(!1)},[]);(0,n.useMemo)(()=>({height:"500px",initialEditType:"wysiwyg",previewStyle:"vertical",initialValue:"",toolbarItems:[["heading","bold","italic","strike"],["hr","quote"],["ul","ol","task","indent","outdent"],["table","image","link"],["code","codeblock"],["scrollSync"]]}),[]);let en=(0,n.useMemo)(()=>u.keywords.map((e,t)=>(0,s.jsxs)("span",{className:h().keywordTag,children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>er(t),className:h().removeKeywordBtn,children:"✕"})]},t)),[u.keywords,er]),ei=(0,n.useMemo)(()=>0===J.length?(0,s.jsx)("p",{style:{textAlign:"center",margin:"20px 0"},children:"임시저장된 글이 없습니다."}):(0,s.jsx)("div",{className:h().draftsList,children:J.map(e=>(0,s.jsxs)("div",{className:h().draftItem,children:[(0,s.jsxs)("div",{className:h().draftHeader,children:[(0,s.jsx)("h4",{children:e.title}),(0,s.jsx)("button",{type:"button",onClick:()=>X(e),className:h().loadDraftBtn,children:"불러오기"}),(0,s.jsx)("button",{type:"button",onClick:()=>Z(e.id),className:h().deleteDraftBtn,children:"삭제"})]}),(0,s.jsx)("p",{children:e.description}),(0,s.jsxs)("p",{children:["작성자: ",e.author]}),(0,s.jsxs)("p",{children:["작성일: ",new Date(e.savedAt).toLocaleDateString()]})]},e.id))}),[J,X,Z]);return((0,n.useEffect)(()=>{m&&!y&&(console.log("✅ 에디터 인스턴스 상태 설정됨, 로드 상태 업데이트"),k(!0))},[m,y]),a)?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c(),{children:[(0,s.jsx)("title",{className:"jsx-b1da6a595698b846",children:"블로그 글 작성 - Logbase"}),(0,s.jsx)("meta",{name:"description",content:"새로운 블로그 글을 작성하세요",className:"jsx-b1da6a595698b846"}),(0,s.jsx)("meta",{name:"viewport",content:"width=device-width, initial-scale=1",className:"jsx-b1da6a595698b846"}),(0,s.jsx)("link",{rel:"icon",href:"/favicon.svg",className:"jsx-b1da6a595698b846"}),(0,s.jsx)("link",{rel:"stylesheet",href:"https://uicdn.toast.com/editor/latest/toastui-editor.min.css",className:"jsx-b1da6a595698b846"}),(0,s.jsx)(o(),{id:"b1da6a595698b846",children:".toastui-editor-defaultUI{border:none!important}.toastui-editor-defaultUI-toolbar{border-bottom:1px solid#e5e7eb!important}"})]}),(0,s.jsxs)("div",{className:"rss-feed-container",children:[(0,s.jsxs)("div",{className:"rss-header",children:[(0,s.jsx)("h1",{children:"블로그 글 작성"}),(0,s.jsx)("p",{style:{textAlign:"center",margin:"10px 0",color:"#666"},children:"새로운 블로그 글을 작성하여 RSS 피드에 추가하세요."})]}),(0,s.jsxs)("div",{className:"rss-content",children:[(0,s.jsxs)("form",{onSubmit:es,className:h().blogForm,children:[x&&(0,s.jsx)("div",{className:h().errorMessage,children:x}),b&&(0,s.jsx)("div",{className:h().successMessage,children:b}),H&&(0,s.jsx)("div",{className:h().draftSavedMessage,children:"✅ 임시저장 완료"}),(0,s.jsxs)("div",{className:h().formSection,children:[(0,s.jsx)("h3",{children:"기본 정보"}),(0,s.jsxs)("div",{className:h().formRow,children:[(0,s.jsxs)("div",{className:h().formGroup,children:[(0,s.jsx)("label",{htmlFor:"title",children:"제목 *"}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",value:u.title,onChange:et,placeholder:"블로그 글 제목을 입력하세요",required:!0,className:h().formInput})]}),(0,s.jsxs)("div",{className:h().formGroup,children:[(0,s.jsx)("label",{htmlFor:"blogName",children:"블로그 이름"}),(0,s.jsx)("input",{type:"text",id:"blogName",name:"blogName",value:u.blogName,onChange:et,placeholder:"블로그 이름",className:h().formInput})]})]})]}),(0,s.jsxs)("div",{className:h().formSection,children:[(0,s.jsx)("div",{className:h().editorHeader,children:(0,s.jsx)("h3",{children:"내용 작성"})}),(0,s.jsxs)("div",{className:h().formGroup,children:[(0,s.jsx)("label",{children:"내용 *"}),R?(0,s.jsxs)("div",{className:h().previewContainer,children:[(0,s.jsxs)("div",{className:h().previewHeader,children:[(0,s.jsx)("h4",{children:"미리보기"}),(0,s.jsx)("button",{type:"button",className:h().closePreviewBtn,onClick:()=>A(!1),children:"✕"})]}),(0,s.jsx)("div",{className:h().previewContent,dangerouslySetInnerHTML:{__html:u.content.replace(/\n/g,"<br>")}})]}):(0,s.jsxs)("div",{className:"".concat(h().editorContainer," ").concat(U?h().dragOver:""),onDragOver:ea,onDragLeave:eo,onDrop:ee,children:[(0,s.jsx)(g,{height:"500px",initialEditType:"wysiwyg",previewStyle:"vertical",initialValue:"",toolbarItems:[["heading","bold","italic","strike"],["hr","quote"],["ul","ol","task","indent","outdent"],["table","image","link"],["code","codeblock"]],onLoad:e=>{console.log("✅ 에디터 로드 완료"),_(e),k(!0)},onChange:W}),U&&(0,s.jsx)("div",{className:h().dragOverlay,children:(0,s.jsx)("div",{className:h().dragMessage,children:"\uD83D\uDCC1 이미지를 여기에 드롭하세요"})})]}),(0,s.jsxs)("div",{className:h().editorFooter,children:[(0,s.jsx)("div",{className:h().editorStatus,children:y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"".concat(h().statusIndicator," ").concat(h().success),children:"✅ 에디터 준비됨"}),(0,s.jsxs)("span",{className:h().modeIndicator,children:["모드: ","wysiwyg"===I?"WYSIWYG":"Markdown"]})]}):(0,s.jsx)("span",{className:"".concat(h().statusIndicator," ").concat(h().loading),children:"⏳ 에디터 로딩 중..."})}),(0,s.jsxs)("div",{className:h().editorStats,children:[(0,s.jsxs)("span",{className:h().statItem,children:["단어: ",L]}),(0,s.jsxs)("span",{className:h().statItem,children:["글자: ",B]})]})]})]})]}),(0,s.jsxs)("div",{className:h().formSection,children:[(0,s.jsx)("h3",{children:"추가 설정"}),(0,s.jsxs)("div",{className:h().formRow,children:[(0,s.jsxs)("div",{className:h().formGroup,children:[(0,s.jsx)("label",{htmlFor:"link",children:"링크"}),(0,s.jsx)("input",{type:"url",id:"link",name:"link",value:u.link,onChange:et,placeholder:"https://example.com/article",className:h().formInput}),(0,s.jsx)("p",{className:h().formHelp,children:"비워두면 자동으로 생성됩니다."})]}),(0,s.jsxs)("div",{className:h().formGroup,children:[(0,s.jsx)("label",{htmlFor:"feedType",children:"피드 타입"}),(0,s.jsxs)("select",{id:"feedType",name:"feedType",value:u.feedType,onChange:et,className:h().formSelect,children:[(0,s.jsx)("option",{value:"logbase",children:"Logbase 블로그"}),(0,s.jsx)("option",{value:"noncompetitor",children:"일반 블로그"}),(0,s.jsx)("option",{value:"competitor",children:"경쟁사 블로그"})]})]})]}),(0,s.jsxs)("div",{className:h().formRow,children:[(0,s.jsxs)("div",{className:h().formGroup,children:[(0,s.jsx)("label",{htmlFor:"keywords",children:"키워드"}),(0,s.jsxs)("div",{className:h().keywordInputContainer,children:[(0,s.jsx)("input",{type:"text",id:"keywords",value:C,onChange:e=>{D(e.target.value)},onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();let t=C.trim();t&&!u.keywords.includes(t)&&(w(e=>({...e,keywords:[...e.keywords,t]})),D(""))}},placeholder:"키워드를 입력하고 Enter 또는 쉼표를 누르세요",className:"".concat(h().formInput," ").concat(h().keywordInput)}),en]}),(0,s.jsxs)("p",{className:h().formHelp,children:["키워드를 입력하고 Enter 또는 쉼표(,)를 눌러 추가하세요.",u.keywords.length>0&&" 현재 ".concat(u.keywords.length,"개 키워드가 추가되었습니다.")]})]}),(0,s.jsxs)("div",{className:h().formGroup,children:[(0,s.jsx)("label",{htmlFor:"author",children:"작성자"}),(0,s.jsx)("input",{type:"text",id:"author",name:"author",value:u.author,onChange:et,placeholder:"작성자 이름",className:h().formInput})]})]})]}),(0,s.jsxs)("div",{className:h().formActions,children:[(0,s.jsxs)("div",{className:h().formActionsLeft,children:[(0,s.jsxs)("button",{type:"button",onClick:()=>Y(!z),className:h().draftsBtn,disabled:0===J.length,children:["\uD83D\uDCC4 임시저장 (",J.length,")"]}),(0,s.jsx)("button",{type:"button",onClick:q,className:h().saveDraftBtn,disabled:F||!u.title&&!u.content,children:F?"저장 중...":"\uD83D\uDCBE 임시저장"})]}),(0,s.jsxs)("div",{className:h().formActionsRight,children:[(0,s.jsx)("button",{type:"button",onClick:()=>r.back(),className:"migrate-btn",style:{background:"#6b7280"},children:"취소"}),(0,s.jsx)("button",{type:"submit",disabled:f||!y,className:"migrate-btn",style:{background:f||!y?"#9ca3af":"#10b981",marginLeft:"12px"},children:f?"저장 중...":y?"글 저장하기":"에디터 로딩 중..."})]})]})]}),z&&(0,s.jsx)("div",{className:h().draftsModal,children:(0,s.jsxs)("div",{className:h().draftsModalContent,children:[(0,s.jsxs)("div",{className:h().draftsModalHeader,children:[(0,s.jsx)("h3",{children:"임시저장 목록"}),(0,s.jsx)("button",{type:"button",className:h().closeModalBtn,onClick:()=>Y(!1),children:"✕"})]}),ei]})})]})]}),(0,s.jsx)("input",{ref:l,type:"file",accept:"image/*",onChange:e=>{var t;let r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&$(r)},style:{display:"none"}})]}):(0,s.jsx)("div",{className:"rss-feed-container",children:(0,s.jsxs)("div",{className:"rss-header",children:[(0,s.jsx)("h1",{children:"로그인이 필요합니다"}),(0,s.jsxs)("div",{className:"rss-controls",style:{justifyContent:"center"},children:[(0,s.jsx)("p",{style:{textAlign:"center",margin:"20px 0"},children:"블로그 글을 작성하려면 로그인해주세요."}),(0,s.jsx)("button",{onClick:()=>r.push("/auth/signin"),className:"migrate-btn",style:{background:"#3b82f6"},children:"로그인하기"})]})]})})}},361:function(e){e.exports={blogForm:"write_blogForm__IW7t6",formSection:"write_formSection__oSkK4",editorHeader:"write_editorHeader__JmhZa",editorControls:"write_editorControls__R3mB2",editorModeSwitch:"write_editorModeSwitch__eOix_",modeBtn:"write_modeBtn__skEhX",active:"write_active__rc2jd",editorActions:"write_editorActions__QAsuy",previewBtn:"write_previewBtn__An4wr",clearBtn:"write_clearBtn__QcFR_",previewContainer:"write_previewContainer__HhXW3",previewHeader:"write_previewHeader__COY5z",closePreviewBtn:"write_closePreviewBtn__6t2uE",previewContent:"write_previewContent__29htV",editorContainer:"write_editorContainer__PM8Lt",dragOver:"write_dragOver__hE5Tw",dragOverlay:"write_dragOverlay__7El2_",dragMessage:"write_dragMessage__mK5Ez",editorLoading:"write_editorLoading__AUmkj",editorLoadingContent:"write_editorLoadingContent__8wz7c",editorLoadingIcon:"write_editorLoadingIcon__Emd2g",editorLoadingText:"write_editorLoadingText__z__K3",editorLoadingProgress:"write_editorLoadingProgress__2mk4f",editorLoadingBar:"write_editorLoadingBar__Tjz97",loading:"write_loading__JbFiI",editorFooter:"write_editorFooter__jhkx1",editorStatus:"write_editorStatus__eLJ_5",statusIndicator:"write_statusIndicator__RZy8l",success:"write_success__nnVGG",modeIndicator:"write_modeIndicator__YJbRt",editorStats:"write_editorStats__BFSbQ",statItem:"write_statItem__d3oB7",draftSavedMessage:"write_draftSavedMessage__7IYTL",formActions:"write_formActions__w3DvM",formActionsLeft:"write_formActionsLeft__r1VLS",formActionsRight:"write_formActionsRight__bhaHo",draftsBtn:"write_draftsBtn__ZmauI",saveDraftBtn:"write_saveDraftBtn__RjVhF",draftsModal:"write_draftsModal__0pl2H",draftsModalContent:"write_draftsModalContent__VUzhT",draftsModalHeader:"write_draftsModalHeader__rTDul",closeModalBtn:"write_closeModalBtn__qyxsY",draftsList:"write_draftsList__k5K1F",noDrafts:"write_noDrafts__q9bty",draftItem:"write_draftItem__MZILj",draftInfo:"write_draftInfo__j_sHt",draftTitle:"write_draftTitle__B2rLF",draftMeta:"write_draftMeta__YL83x",draftActions:"write_draftActions__eGDV2",loadDraftBtn:"write_loadDraftBtn__wK_RO",deleteDraftBtn:"write_deleteDraftBtn__jEnJz",formRow:"write_formRow__iXhqG",formGroup:"write_formGroup__C_K1C",formInput:"write_formInput__TFzUz",formTextarea:"write_formTextarea__XTdUk",formSelect:"write_formSelect__EcjUo",formHelp:"write_formHelp__CRpNh",keywordInputContainer:"write_keywordInputContainer__FNcq1",keywordInput:"write_keywordInput__CTBxM",keywordTags:"write_keywordTags__lSqe0",keywordTag:"write_keywordTag__R357I",removeKeywordBtn:"write_removeKeywordBtn__Y5KNJ",errorMessage:"write_errorMessage__LFHMg",successMessage:"write_successMessage__BoWwD",editButton:"write_editButton__lY_dG"}}},function(e){e.O(0,[779,888,774,179],function(){return e(e.s=6470)}),_N_E=e.O()}]);