(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[477],{9451:function(e,t,r){(window.__NEXT_P=window.__NEXT_P||[]).push(["/blog/edit/[guid]",function(){return r(6481)}])},6481:function(e,t,r){"use strict";r.r(t),r.d(t,{default:function(){return g}});var s=r(5893),o=r(645),i=r.n(o),d=r(7294),a=r(1163),n=r(9008),c=r.n(n),l=r(837),_=r(5152),f=r.n(_),w=r(361),m=r.n(w);let u=f()(()=>r.e(725).then(r.bind(r,4725)),{loadableGenerated:{webpack:()=>[4725]},ssr:!1});function g(){let e=(0,a.useRouter)(),{user:t}=(0,l.a)(),{guid:r}=e.query,[o,n]=(0,d.useState)({title:"",description:"",content:"",link:"",blogName:"Logbase Blog",feedType:"logbase",keywords:[],author:(null==t?void 0:t.email)||""}),[_,f]=(0,d.useState)(null),[w,g]=(0,d.useState)(!0),[x,h]=(0,d.useState)(null),[j,b]=(0,d.useState)(null),[p,y]=(0,d.useState)(!1),[v,k]=(0,d.useState)("");(0,d.useEffect)(()=>{if(console.log("✏️[EDIT PAGE] 1. 데이터 로딩 useEffect 시작.",{guid:r,user:!!t}),!r||!t){console.log("✏️[EDIT PAGE] guid 또는 user 정보가 없어 API 호출을 중단합니다."),r||g(!1);return}(async()=>{g(!0),h(null),console.log("✏️[EDIT PAGE] 1a. API 호출 시작: /api/blog/".concat(r));try{let e=await fetch("/api/blog/".concat(r));if(console.log("✏️[EDIT PAGE] 1b. API 응답 상태:",e.status),!e.ok)throw Error("글을 불러오는데 실패했습니다.");let s=await e.json();if(console.log("✏️[EDIT PAGE] 1c. API 응답 데이터:",s),s.success){let e=s.data;n({title:e.title||"",description:e.description||"",content:e.content||"",link:e.link||"",blogName:e.blogName||"Logbase Blog",feedType:e.feedType||"logbase",keywords:Array.isArray(e.categories)?e.categories:Array.isArray(e.matchedKeywords)?e.matchedKeywords:[],author:e.author||t.email||""}),console.log("✏️[EDIT PAGE] 1d. formData 상태 업데이트 완료.")}else h(s.error||"글 정보를 찾을 수 없습니다."),console.error("✏️[EDIT PAGE] 1e. API에서 success: false를 반환했습니다.",s.error)}catch(e){h(e.message),console.error("✏️[EDIT PAGE] 1f. API 호출 중 예외 발생:",e)}finally{g(!1),console.log("✏️[EDIT PAGE] 1g. 데이터 로딩 프로세스 종료.")}})()},[r,t]),(0,d.useEffect)(()=>{console.log("✏️[EDIT PAGE] 2. 에디터 내용 설정 useEffect 시작.",{editorLoaded:p,hasContent:!!o.content,loading:w}),p&&o.content&&!w&&_&&_.getMarkdown()!==o.content&&(_.setMarkdown(o.content),console.log("✏️[EDIT PAGE] 2a. 에디터에 기존 글 내용을 설정했습니다."))},[p,o.content,w]);let N=e=>{n(t=>({...t,keywords:t.keywords.filter((t,r)=>r!==e)}))},E=async t=>{t.preventDefault(),g(!0),h(null),b(null);let s=(null==_?void 0:_.getMarkdown())||"";if(!o.title.trim()){h("제목을 입력해주세요."),g(!1);return}if(!s.trim()){h("내용을 입력해주세요."),g(!1);return}try{let t=(null==_?void 0:_.getHTML().replace(/<[^>]*>/g,"").trim())||"",i=t.length>200?t.substring(0,200)+"...":t,d=await fetch("/api/blog/".concat(r),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({...o,content:s,description:i,matchedKeywords:o.keywords,categories:o.keywords})}),a=await d.json();if(a.success)b("글이 성공적으로 수정되었습니다. 잠시 후 상세 페이지로 이동합니다."),setTimeout(()=>e.push("/blog/".concat(a.guid||r)),2e3);else throw Error(a.error||"글 수정에 실패했습니다.")}catch(e){h(e.message)}finally{g(!1)}},I=(0,d.useMemo)(()=>o.keywords.map((e,t)=>(0,s.jsxs)("span",{className:m().keywordTag,children:[e,(0,s.jsx)("button",{type:"button",onClick:()=>N(t),className:m().removeKeywordBtn,children:"✕"})]},t)),[o.keywords]);return t?(console.log("✏️[EDIT PAGE] 3. 렌더링 직전 상태:",{loading:w,pageError:x,success:j,formDataTitle:o.title}),(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(c(),{children:[(0,s.jsx)("title",{className:"jsx-446d12f4d3cb794f",children:"블로그 글 수정 - Logbase"}),(0,s.jsx)("meta",{name:"robots",content:"noindex, nofollow",className:"jsx-446d12f4d3cb794f"}),(0,s.jsx)("link",{rel:"stylesheet",href:"https://uicdn.toast.com/editor/latest/toastui-editor.min.css",className:"jsx-446d12f4d3cb794f"})]}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f rss-feed-container",children:[(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f rss-header",children:[(0,s.jsx)("h1",{className:"jsx-446d12f4d3cb794f",children:"블로그 글 수정"}),(0,s.jsx)("p",{style:{textAlign:"center",margin:"10px 0",color:"#666"},className:"jsx-446d12f4d3cb794f",children:"기존 블로그 글의 내용을 수정합니다."})]}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f rss-content",children:[w&&(0,s.jsx)("div",{className:"jsx-446d12f4d3cb794f "+(m().editorLoading||""),children:(0,s.jsx)("p",{className:"jsx-446d12f4d3cb794f",children:"글 정보를 불러오는 중..."})}),(0,s.jsxs)("form",{onSubmit:E,className:"jsx-446d12f4d3cb794f "+(m().blogForm||""),children:[x&&(0,s.jsx)("div",{className:"jsx-446d12f4d3cb794f "+(m().errorMessage||""),children:x}),j&&(0,s.jsx)("div",{className:"jsx-446d12f4d3cb794f "+(m().successMessage||""),children:j}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().formSection||""),children:[(0,s.jsx)("div",{className:"jsx-446d12f4d3cb794f "+(m().editorHeader||""),children:(0,s.jsx)("h3",{className:"jsx-446d12f4d3cb794f",children:"기본 정보"})}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().formGroup||""),children:[(0,s.jsx)("label",{htmlFor:"title",className:"jsx-446d12f4d3cb794f",children:"제목 *"}),(0,s.jsx)("input",{type:"text",id:"title",name:"title",value:o.title,onChange:e=>{let{name:t,value:r}=e.target;n(e=>({...e,[t]:r}))},placeholder:"블로그 글 제목을 입력하세요",required:!0,className:"jsx-446d12f4d3cb794f "+(m().formInput||"")})]})]}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().formSection||""),children:[(0,s.jsx)("div",{className:"jsx-446d12f4d3cb794f "+(m().editorHeader||""),children:(0,s.jsx)("h3",{className:"jsx-446d12f4d3cb794f",children:"내용 작성"})}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().formGroup||""),children:[(0,s.jsx)("label",{className:"jsx-446d12f4d3cb794f",children:"내용 *"}),(0,s.jsx)("div",{className:"jsx-446d12f4d3cb794f "+(m().editorContainer||""),children:(0,s.jsx)(u,{height:"500px",initialEditType:"wysiwyg",previewStyle:"vertical",initialValue:o.content||"",onLoad:e=>{f(e),console.log("✏️[EDIT PAGE] Editor 로드 완료!"),y(!0)},onChange:()=>{_&&n(e=>({...e,content:_.getMarkdown()}))}})})]})]}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().formSection||""),children:[(0,s.jsx)("div",{className:"jsx-446d12f4d3cb794f "+(m().editorHeader||""),children:(0,s.jsx)("h3",{className:"jsx-446d12f4d3cb794f",children:"추가 설정"})}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().formGroup||""),children:[(0,s.jsx)("label",{htmlFor:"keywords",className:"jsx-446d12f4d3cb794f",children:"키워드"}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().keywordInputContainer||""),children:[(0,s.jsx)("input",{type:"text",id:"keywords",value:v,onChange:e=>k(e.target.value),onKeyDown:e=>{if("Enter"===e.key||","===e.key){e.preventDefault();let t=v.trim();t&&!o.keywords.includes(t)&&(n(e=>({...e,keywords:[...e.keywords,t]})),k(""))}},placeholder:"키워드를 입력하고 Enter 또는 쉼표를 누르세요",className:"jsx-446d12f4d3cb794f "+"".concat(m().formInput," ").concat(m().keywordInput)}),I]})]})]}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().formActions||""),children:[(0,s.jsx)("div",{className:"jsx-446d12f4d3cb794f "+(m().formActionsLeft||"")}),(0,s.jsxs)("div",{className:"jsx-446d12f4d3cb794f "+(m().formActionsRight||""),children:[(0,s.jsx)("button",{type:"button",onClick:()=>e.back(),style:{background:"#6b7280"},disabled:w,className:"jsx-446d12f4d3cb794f migrate-btn",children:"취소"}),(0,s.jsx)("button",{type:"submit",disabled:w||!p,style:{background:w||!p?"#9ca3af":"#10b981",marginLeft:"12px"},className:"jsx-446d12f4d3cb794f migrate-btn",children:w?"수정 중...":p?"수정하기":"에디터 로딩 중..."})]})]})]})]})]}),(0,s.jsx)(i(),{id:"446d12f4d3cb794f",children:".toastui-editor-defaultUI,.toastui-editor-ww-container{border:1px solid#e5e7eb!important}.toastui-editor-defaultUI-toolbar{border-bottom:1px solid#e5e7eb!important}"})]})):(0,s.jsxs)("div",{className:"rss-feed-container",children:[(0,s.jsx)("h1",{children:"접근 권한 없음"}),(0,s.jsx)("p",{children:"글을 수정하려면 로그인이 필요합니다."})]})}},361:function(e){e.exports={blogForm:"write_blogForm__IW7t6",formSection:"write_formSection__oSkK4",editorHeader:"write_editorHeader__JmhZa",editorControls:"write_editorControls__R3mB2",editorModeSwitch:"write_editorModeSwitch__eOix_",modeBtn:"write_modeBtn__skEhX",active:"write_active__rc2jd",editorActions:"write_editorActions__QAsuy",previewBtn:"write_previewBtn__An4wr",clearBtn:"write_clearBtn__QcFR_",previewContainer:"write_previewContainer__HhXW3",previewHeader:"write_previewHeader__COY5z",closePreviewBtn:"write_closePreviewBtn__6t2uE",previewContent:"write_previewContent__29htV",editorContainer:"write_editorContainer__PM8Lt",dragOver:"write_dragOver__hE5Tw",dragOverlay:"write_dragOverlay__7El2_",dragMessage:"write_dragMessage__mK5Ez",editorLoading:"write_editorLoading__AUmkj",editorLoadingContent:"write_editorLoadingContent__8wz7c",editorLoadingIcon:"write_editorLoadingIcon__Emd2g",editorLoadingText:"write_editorLoadingText__z__K3",editorLoadingProgress:"write_editorLoadingProgress__2mk4f",editorLoadingBar:"write_editorLoadingBar__Tjz97",loading:"write_loading__JbFiI",editorFooter:"write_editorFooter__jhkx1",editorStatus:"write_editorStatus__eLJ_5",statusIndicator:"write_statusIndicator__RZy8l",success:"write_success__nnVGG",modeIndicator:"write_modeIndicator__YJbRt",editorStats:"write_editorStats__BFSbQ",statItem:"write_statItem__d3oB7",draftSavedMessage:"write_draftSavedMessage__7IYTL",formActions:"write_formActions__w3DvM",formActionsLeft:"write_formActionsLeft__r1VLS",formActionsRight:"write_formActionsRight__bhaHo",draftsBtn:"write_draftsBtn__ZmauI",saveDraftBtn:"write_saveDraftBtn__RjVhF",draftsModal:"write_draftsModal__0pl2H",draftsModalContent:"write_draftsModalContent__VUzhT",draftsModalHeader:"write_draftsModalHeader__rTDul",closeModalBtn:"write_closeModalBtn__qyxsY",draftsList:"write_draftsList__k5K1F",noDrafts:"write_noDrafts__q9bty",draftItem:"write_draftItem__MZILj",draftInfo:"write_draftInfo__j_sHt",draftTitle:"write_draftTitle__B2rLF",draftMeta:"write_draftMeta__YL83x",draftActions:"write_draftActions__eGDV2",loadDraftBtn:"write_loadDraftBtn__wK_RO",deleteDraftBtn:"write_deleteDraftBtn__jEnJz",formRow:"write_formRow__iXhqG",formGroup:"write_formGroup__C_K1C",formInput:"write_formInput__TFzUz",formTextarea:"write_formTextarea__XTdUk",formSelect:"write_formSelect__EcjUo",formHelp:"write_formHelp__CRpNh",keywordInputContainer:"write_keywordInputContainer__FNcq1",keywordInput:"write_keywordInput__CTBxM",keywordTags:"write_keywordTags__lSqe0",keywordTag:"write_keywordTag__R357I",removeKeywordBtn:"write_removeKeywordBtn__Y5KNJ",errorMessage:"write_errorMessage__LFHMg",successMessage:"write_successMessage__BoWwD",editButton:"write_editButton__lY_dG"}}},function(e){e.O(0,[779,888,774,179],function(){return e(e.s=9451)}),_N_E=e.O()}]);