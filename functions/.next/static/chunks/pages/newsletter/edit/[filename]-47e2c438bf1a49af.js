(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[399],{3410:function(e,t,i){(window.__NEXT_P=window.__NEXT_P||[]).push(["/newsletter/edit/[filename]",function(){return i(4496)}])},4496:function(e,t,i){"use strict";i.r(t),i.d(t,{default:function(){return c}});var n=i(5893),s=i(7294),a=i(1163),l=i(1664),r=i.n(l);function c(){let e=(0,a.useRouter)(),t=(0,a.useRouter)().query.filename,[i,l]=(0,s.useState)({title:"",content:"",url:"",sentDate:new Date().toISOString().slice(0,10),recipients:[]}),[c,d]=(0,s.useState)(!0),[o,p]=(0,s.useState)(!1),[h,m]=(0,s.useState)(""),[x,u]=(0,s.useState)(!1),[g,j]=(0,s.useState)([]),[y,f]=(0,s.useState)(!1),[b,v]=(0,s.useState)(!1);(0,s.useEffect)(()=>{t&&w()},[t]);let w=async()=>{try{let e=await fetch("/api/newsletter-get/".concat(t));if(e.ok){let t=(await e.json()).newsletter;l({title:t.title||"",content:t.content||"",url:t.url||"",sentDate:t.sentDate||new Date().toISOString().slice(0,10),recipients:t.recipients||[]})}else m("뉴스레터를 찾을 수 없습니다.")}catch(e){m("뉴스레터를 불러오는데 실패했습니다.")}finally{d(!1)}},N=async n=>{if(n.preventDefault(),!i.title.trim()||!i.content.trim()||!i.sentDate){alert("제목, 내용, 발송일은 필수 항목입니다.");return}if(0===i.recipients.length){alert("수신자를 한 명 이상 선택하세요.");return}p(!0);try{let n=await fetch("/api/newsletter-update/".concat(t),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(i)}),s=await n.json();if(n.ok)alert("뉴스레터가 성공적으로 업데이트되었습니다!"),e.push("/newsletter");else throw Error(s.message||"뉴스레터 업데이트에 실패했습니다.")}catch(t){let e=t instanceof Error?t.message:String(t);alert("오류: ".concat(e))}finally{p(!1)}},k=e=>{let{name:t,value:i}=e.target;l(e=>({...e,[t]:i}))},S=async()=>{f(!0);try{let e=await fetch("/api/newsletter-recipients");if(e.ok){let t=await e.json();j(t.recipients||[])}else console.error("수신자 목록을 불러오지 못했습니다.")}catch(e){console.error("수신자 목록 로드 오류:",e)}finally{f(!1)}},C=e=>{v(e),e?l(e=>({...e,recipients:[...g]})):l(e=>({...e,recipients:[]}))},D=(e,t)=>{t?l(t=>({...t,recipients:[...t.recipients,e]})):l(t=>({...t,recipients:t.recipients.filter(t=>t.id!==e.id)}))};return c?(0,n.jsx)("div",{className:"container",children:(0,n.jsx)("div",{className:"loading",children:"뉴스레터를 불러오는 중..."})}):h?(0,n.jsxs)("div",{className:"container",children:[(0,n.jsx)("div",{className:"error",children:h}),(0,n.jsx)(r(),{href:"/newsletter",children:(0,n.jsx)("button",{type:"button",className:"btn-back","data-clarity-tag":"newsletter-edit-back-to-list",children:"목록으로 돌아가기"})})]}):(0,n.jsxs)("div",{className:"container",children:[(0,n.jsxs)("div",{className:"header",children:[(0,n.jsx)("h1",{children:"뉴스레터 편집"}),(0,n.jsx)(r(),{href:"/newsletter",children:(0,n.jsx)("button",{type:"button",className:"btn-back","data-clarity-tag":"newsletter-edit-back-to-list",children:"목록으로 돌아가기"})})]}),(0,n.jsxs)("form",{onSubmit:N,children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"title",children:"제목 *"}),(0,n.jsx)("input",{type:"text",id:"title",name:"title",value:i.title,onChange:k,required:!0,placeholder:"뉴스레터 제목을 입력하세요","data-clarity-tag":"newsletter-edit-title-input"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"content",children:"내용 *"}),(0,n.jsx)("textarea",{id:"content",name:"content",value:i.content,onChange:k,required:!0,rows:10,placeholder:"뉴스레터 내용을 입력하세요","data-clarity-tag":"newsletter-edit-content-input"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"url",children:"URL"}),(0,n.jsx)("input",{type:"url",id:"url",name:"url",value:i.url,onChange:k,placeholder:"관련 URL을 입력하세요 (선택사항)","data-clarity-tag":"newsletter-edit-url-input"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{htmlFor:"sentDate",children:"발송일 *"}),(0,n.jsx)("input",{type:"date",id:"sentDate",name:"sentDate",value:i.sentDate,onChange:k,required:!0,"data-clarity-tag":"newsletter-edit-sentdate-input"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"수신자 선택 *"}),(0,n.jsxs)("div",{className:"recipients-summary",children:[(0,n.jsxs)("div",{className:"recipients-count",children:[(0,n.jsxs)("span",{children:[i.recipients.length,"명 선택됨"]}),(0,n.jsx)("button",{type:"button",className:"btn-select-recipients",onClick:()=>{u(!0),S()},"data-clarity-tag":"newsletter-edit-select-recipients",children:"수신자 선택"})]}),i.recipients.length>0&&(0,n.jsxs)("div",{className:"selected-recipients",children:[(0,n.jsx)("h4",{children:"선택된 수신자:"}),(0,n.jsx)("div",{className:"recipients-grid",children:i.recipients.map(e=>(0,n.jsxs)("div",{className:"selected-recipient-item",children:[(0,n.jsxs)("div",{className:"recipient-info",children:[(0,n.jsxs)("div",{className:"recipient-info-line",children:[(0,n.jsx)("span",{className:"recipient-name",children:e.name}),(0,n.jsxs)("span",{className:"recipient-company",children:["(",e.company,")"]})]}),(0,n.jsx)("div",{className:"recipient-info-line",children:(0,n.jsx)("span",{className:"recipient-email",children:e.email})})]}),(0,n.jsx)("button",{type:"button",className:"btn-remove-recipient",onClick:()=>D(e,!1),title:"".concat(e.name," 제거"),"data-clarity-tag":"newsletter-edit-remove-recipient",children:"\xd7"})]},e.id))})]})]})]}),(0,n.jsx)("div",{className:"form-actions",children:(0,n.jsx)("button",{type:"submit",className:"btn-submit",disabled:o,"data-clarity-tag":"newsletter-edit-submit",children:o?"저장 중...":"뉴스레터 저장"})})]}),x&&(0,n.jsx)("div",{className:"modal-overlay newsletter-edit-modal-overlay",style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3,visibility:"visible",opacity:1},children:(0,n.jsxs)("div",{className:"newsletter-edit-modal",style:{background:"white",borderRadius:"8px",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.1)",maxWidth:"500px",width:"90%",maxHeight:"300px !important",height:"auto !important",overflow:"hidden",display:"flex",flexDirection:"column",visibility:"visible",opacity:1,margin:"auto",position:"relative",inset:"auto",minHeight:"auto !important"},children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsx)("h3",{children:"수신자 선택"}),(0,n.jsx)("button",{type:"button",className:"btn-close",onClick:()=>{u(!1)},"data-clarity-tag":"newsletter-edit-recipients-modal-close",children:"\xd7"})]}),(0,n.jsxs)("div",{className:"modal-body",children:[(0,n.jsx)("div",{style:{marginBottom:"12px"},children:(0,n.jsxs)("label",{style:{display:"flex",alignItems:"center",gap:"8px",cursor:"pointer",fontSize:"14px",fontWeight:"500",color:"#333"},children:[(0,n.jsx)("input",{type:"checkbox",checked:b,onChange:e=>C(e.target.checked),style:{width:"16px",height:"16px",margin:"0"},"data-clarity-tag":"newsletter-edit-select-all-recipients"}),(0,n.jsxs)("span",{children:["전체 선택 (",g.length,"명)"]})]})}),(0,n.jsx)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"8px",maxHeight:"240px",overflowY:"auto",border:"1px solid #ddd",borderRadius:"4px",background:"white",padding:"8px"},children:y?(0,n.jsx)("div",{style:{gridColumn:"1 / -1",padding:"20px",textAlign:"center",color:"#666"},children:"수신자 목록을 불러오는 중..."}):g.map(e=>(0,n.jsx)("div",{style:{border:"1px solid #e5e7eb",borderRadius:"6px",padding:"10px",background:"#f9fafb",fontSize:"13px"},children:(0,n.jsxs)("label",{style:{display:"flex",alignItems:"flex-start",gap:"8px",cursor:"pointer",margin:"0",padding:"0",width:"100%"},children:[(0,n.jsx)("input",{type:"checkbox",checked:i.recipients.some(t=>t.id===e.id),onChange:t=>D(e,t.target.checked),style:{width:"16px",height:"16px",margin:"0",marginTop:"2px",flexShrink:"0"},"data-clarity-tag":"newsletter-edit-recipient-checkbox"}),(0,n.jsxs)("div",{style:{flex:"1",minWidth:"0"},children:[(0,n.jsxs)("div",{style:{marginBottom:"3px"},children:[(0,n.jsx)("span",{style:{fontWeight:"bold",marginRight:"4px"},children:e.name}),(0,n.jsxs)("span",{style:{color:"#666"},children:["(",e.company,")"]})]}),(0,n.jsx)("div",{style:{color:"#888",fontSize:"11px",wordBreak:"break-all"},children:e.email})]})]})},e.id))})]}),(0,n.jsx)("div",{className:"modal-footer",children:(0,n.jsx)("button",{type:"button",className:"btn-confirm",onClick:()=>{u(!1)},"data-clarity-tag":"newsletter-edit-recipients-confirm",children:"확인"})})]})})]})}},1163:function(e,t,i){e.exports=i(3079)}},function(e){e.O(0,[888,774,179],function(){return e(e.s=3410)}),_N_E=e.O()}]);