# ğŸš€ Firebase Functions ë°°í¬ ê°€ì´ë“œ

## ğŸ“ **ì¤‘ìš”í•œ íŒŒì¼ êµ¬ì¡°**

```
logbase-website/
â”œâ”€â”€ functions/                    # Firebase Functions ì†ŒìŠ¤
â”‚   â”œâ”€â”€ index.js                 # ğŸ”¥ í•µì‹¬ - Functions ì—”íŠ¸ë¦¬í¬ì¸íŠ¸
â”‚   â”œâ”€â”€ package.json             # Functions ì˜ì¡´ì„±
â”‚   â”œâ”€â”€ .next/                   # Next.js ë¹Œë“œ ê²°ê³¼ë¬¼ (ë³µì‚¬ë¨)
â”‚   â”œâ”€â”€ src/                     # ì†ŒìŠ¤ì½”ë“œ (ë³µì‚¬ë¨)
â”‚   â”œâ”€â”€ next.config.js           # Next.js ì„¤ì • (ë³µì‚¬ë¨)
â”‚   â””â”€â”€ tsconfig.json            # TypeScript ì„¤ì • (ë³µì‚¬ë¨)
â”œâ”€â”€ src/                         # ì›ë³¸ ì†ŒìŠ¤ì½”ë“œ
â”œâ”€â”€ next.config.js               # ğŸ”¥ í•µì‹¬ - output: 'standalone'
â”œâ”€â”€ firebase.json                # ğŸ”¥ í•µì‹¬ - Firebase ì„¤ì •
â””â”€â”€ .next/                       # ë¹Œë“œ ê²°ê³¼ë¬¼ (ì›ë³¸)
```

## ğŸ”§ **ë¹Œë“œ í”„ë¡œì„¸ìŠ¤**

### 1ï¸âƒ£ **ë©”ì¸ ë¹Œë“œ (í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ)**
```bash
cd C:\00.PROJECT\NEXTJS\logbase-website
npm run build
```
- âœ… `output: 'standalone'` ì„¤ì •ìœ¼ë¡œ ë¹Œë“œ
- âœ… `.next/standalone/` ë””ë ‰í† ë¦¬ ìƒì„±ë¨

### 2ï¸âƒ£ **Functions ë””ë ‰í† ë¦¬ë¡œ íŒŒì¼ ë³µì‚¬**
```bash
# .next ë””ë ‰í† ë¦¬ ë³µì‚¬
Remove-Item -Recurse -Force functions/.next -ErrorAction SilentlyContinue
Copy-Item -Recurse .next functions/

# ì†ŒìŠ¤ì½”ë“œ ë³µì‚¬
Remove-Item -Recurse -Force functions/src -ErrorAction SilentlyContinue
Copy-Item -Recurse src functions/

# ì„¤ì • íŒŒì¼ ë³µì‚¬
Copy-Item next.config.js functions/ -Force
Copy-Item tsconfig.json functions/ -Force
```

### 3ï¸âƒ£ **Functions ì˜ì¡´ì„± í™•ì¸**
```bash
cd functions
npm install next  # Next.js íŒ¨í‚¤ì§€ í•„ìˆ˜
cd ..
```

## ğŸ”¥ **í•µì‹¬ ì„¤ì • íŒŒì¼ë“¤**

### **1. `next.config.js`**
```javascript
const nextConfig = {
  output: 'standalone',  // ğŸ”¥ í•„ìˆ˜! Firebase Functionsìš©
  eslint: { ignoreDuringBuilds: true },
  typescript: { ignoreBuildErrors: true }
};
```

### **2. `functions/index.js`**
```javascript
// ğŸ”¥ ë¦¬ì „ ì„¤ì • í•„ìˆ˜
exports.nextjsFunc = onRequest({
  region: 'asia-northeast3',  // í•œêµ­ ë¦¬ì „
  timeoutSeconds: 540,
  memory: '2GiB'
}, async (req, res) => {
  // Next.js ì•± ì´ˆê¸°í™” ë° ìš”ì²­ ì²˜ë¦¬
});
```

### **3. `firebase.json`**
```json
{
  "functions": [{
    "source": "functions",  // Functions ì†ŒìŠ¤ ìœ„ì¹˜
    "runtime": "nodejs20"
  }],
  "hosting": {
    "rewrites": [{
      "source": "**",
      "function": {
        "functionId": "nextjsFunc",
        "region": "asia-northeast3"  // ğŸ”¥ ë¦¬ì „ ì¼ì¹˜ í•„ìˆ˜
      }
    }]
  }
}
```

## âš ï¸ **ë°°í¬ì‹œ ì£¼ì˜ì‚¬í•­**

### **DO âœ…**
1. **ë¹Œë“œëŠ” í•­ìƒ í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ**: `logbase-website/`
2. **ë¦¬ì „ ì¼ì¹˜**: `firebase.json`ê³¼ `functions/index.js` ëª¨ë‘ `asia-northeast3`
3. **íŒŒì¼ ë³µì‚¬ ìˆœì„œ**: ë¹Œë“œ â†’ íŒŒì¼ë³µì‚¬ â†’ ë°°í¬
4. **next íŒ¨í‚¤ì§€**: `functions/package.json`ì— í¬í•¨ í•„ìˆ˜
5. **standalone ëª¨ë“œ**: `output: 'standalone'` ì„¤ì •

### **DON'T âŒ**
1. ~~`functions` ë””ë ‰í† ë¦¬ì—ì„œ ë¹Œë“œí•˜ì§€ ë§ ê²ƒ~~
2. ~~ë¦¬ì „ ë¶ˆì¼ì¹˜ (us-central1 vs asia-northeast3)~~
3. ~~standalone ì„œë²„ ì§ì ‘ ì‹¤í–‰ (í¬íŠ¸ ì¶©ëŒ)~~
4. ~~`getRequestHandler()` ì—†ì´ ë°°í¬~~

## ğŸš€ **ë°°í¬ ëª…ë ¹ì–´ ìˆœì„œ**

### **ì „ì²´ ë°°í¬ ìŠ¤í¬ë¦½íŠ¸ (PowerShell)**
```powershell
# 1. í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ë¹Œë“œ
cd C:\00.PROJECT\NEXTJS\logbase-blog
npm run build

# 2. íŒŒì¼ ë³µì‚¬
Remove-Item -Recurse -Force functions/.next -ErrorAction SilentlyContinue; Copy-Item -Recurse .next functions/
Remove-Item -Recurse -Force functions/src -ErrorAction SilentlyContinue; Copy-Item -Recurse src functions/
Copy-Item next.config.js functions/ -Force; Copy-Item tsconfig.json functions/ -Force

# 3. Functions ì˜ì¡´ì„± í™•ì¸
cd functions; npm install next; cd ..

# 4. ë°°í¬
firebase deploy --only functions
```

### **ë‹¨ê³„ë³„ ì‹¤í–‰**
```bash
# 1ë‹¨ê³„: ë¹Œë“œ
npm run build

# 2ë‹¨ê³„: íŒŒì¼ ë³µì‚¬
Remove-Item -Recurse -Force functions/.next -ErrorAction SilentlyContinue
Copy-Item -Recurse .next functions/
Remove-Item -Recurse -Force functions/src -ErrorAction SilentlyContinue  
Copy-Item -Recurse src functions/
Copy-Item next.config.js functions/ -Force
Copy-Item tsconfig.json functions/ -Force

# 3ë‹¨ê³„: ì˜ì¡´ì„± ì„¤ì¹˜
cd functions
npm install next
cd ..

# 4ë‹¨ê³„: ë°°í¬
firebase deploy --only functions
```

## ğŸ¯ **ì„±ê³µ ì§€í‘œ**

### **ë°°í¬ ì„±ê³µì‹œ ì¶œë ¥**
```
âœ… functions[nextjsFunc(asia-northeast3)] Successful create operation.
âœ… Function URL: https://asia-northeast3-logbase-blog-83db6.cloudfunctions.net/nextjsFunc
```

### **ë¡œê·¸ì—ì„œ í™•ì¸í•´ì•¼ í•  ë‚´ìš©**
```
ğŸ”§ Next.js ì•± ì¤€ë¹„ ì¤‘...
âœ… Next.js ì•± ì´ˆê¸°í™” ì™„ë£Œ
ğŸ”§ Next.jsë¡œ ìš”ì²­ ì „ë‹¬
```

### **ë¡œê·¸ í™•ì¸ ëª…ë ¹ì–´**
```bash
firebase functions:log --only nextjsFunc
```

## ğŸ› **íŠ¸ëŸ¬ë¸”ìŠˆíŒ…**

### **ìì£¼ ë°œìƒí•˜ëŠ” ì˜¤ë¥˜ë“¤**
1. **`req.on is not a function`**
   - ì›ì¸: standalone ì„œë²„ ì§ì ‘ ì‹¤í–‰
   - í•´ê²°: `getRequestHandler()` ì‚¬ìš©

2. **`EADDRINUSE: address already in use`**
   - ì›ì¸: í¬íŠ¸ 8080 ì¶©ëŒ
   - í•´ê²°: standalone ì„œë²„ ëŒ€ì‹  Next.js ì•± ê°ì²´ ì‚¬ìš©

3. **ë¦¬ì „ ë¶ˆì¼ì¹˜ ì˜¤ë¥˜**
   - ì›ì¸: `firebase.json`ê³¼ `functions/index.js` ë¦¬ì „ ë‹¤ë¦„
   - í•´ê²°: ëª¨ë‘ `asia-northeast3`ë¡œ í†µì¼

4. **ë¹Œë“œ íŒŒì¼ ì—†ìŒ**
   - ì›ì¸: í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ ë¹Œë“œ ì•ˆí•¨
   - í•´ê²°: `logbase-blog/`ì—ì„œ `npm run build`

## ğŸ“ **ì²´í¬ë¦¬ìŠ¤íŠ¸**

ë°°í¬ ì „ í™•ì¸ì‚¬í•­:
- [ ] í”„ë¡œì íŠ¸ ë£¨íŠ¸ì—ì„œ `npm run build` ì‹¤í–‰
- [ ] `.next/standalone/` ë””ë ‰í† ë¦¬ ì¡´ì¬ í™•ì¸
- [ ] `functions/.next/` ë³µì‚¬ ì™„ë£Œ
- [ ] `functions/src/` ë³µì‚¬ ì™„ë£Œ
- [ ] `functions/next.config.js` ë³µì‚¬ ì™„ë£Œ
- [ ] `functions/package.json`ì— `next` íŒ¨í‚¤ì§€ í¬í•¨
- [ ] `firebase.json`ê³¼ `functions/index.js` ë¦¬ì „ ì¼ì¹˜
- [ ] `firebase deploy --only functions` ì‹¤í–‰

---

**ë§ˆì§€ë§‰ ì„±ê³µ ë°°í¬ì¼**: 2025-07-28
**ë°°í¬ í™˜ê²½**: Windows PowerShell
**ë¦¬ì „**: asia-northeast3
**Next.js ë²„ì „**: 14.2.5
**Node.js ë²„ì „**: 20 